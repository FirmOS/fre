require("dojo/_base/array dojo/dom-geometry dojo/aspect dgrid/OnDemandGrid dgrid/Grid dgrid/Selection dgrid/selector dgrid/tree dgrid/extensions/ColumnResizer dgrid/extensions/ColumnHider dgrid/extensions/ColumnReorder dgrid/extensions/DijitRegistry dgrid/extensions/DnD dojox/form/CheckedMultiSelect dojox/form/FileInput dojox/form/Uploader dojox/form/uploader/FileList dojox/validate/web dojox/validate/check dojox/widget/Calendar dojox/gfx dojox/gfx/fx dojox/gfx/utils dojox/gfx/Moveable dojox/gesture/tap dojox/gesture/swipe dojox/html/styles dojo/dom-construct dojox/charting/widget/Chart dojox/charting/widget/Legend dojox/charting/axis2d/Default dojox/charting/plot2d/Lines dojox/charting/plot2d/Pie dojox/charting/plot2d/ClusteredColumns dijit/Menu dijit/Dialog dijit/Tree dijit/Toolbar dijit/ProgressBar dijit/Tooltip dijit/form/TextBox dijit/form/DateTextBox dijit/form/Form dijit/form/FilteringSelect dijit/form/Textarea dijit/form/NumberTextBox dijit/form/ComboBox dijit/form/TimeTextBox dijit/form/Select dijit/form/NumberSpinner dijit/form/HorizontalSlider dijit/layout/ContentPane dijit/layout/TabContainer dijit/layout/BorderContainer dijit/layout/AccordionContainer dojo/io/iframe".split(" "),
function(v,w,x,y,z,A,B,C,D,E,F,G,H){dojo.array=v;dojo.domGeo=w;dojo.aspect=x;dgrid={};dgrid.OnDemandGrid=y;dgrid.Grid=z;dgrid.Selection=A;dgrid.selector=B;dgrid.tree=C;dgrid.ColumnResizer=D;dgrid.ColumnHider=E;dgrid.ColumnReorder=F;dgrid.DijitRegistry=G;dgrid.DnD=H;dojo.declare("FIRMOS.wsConnectionHandler",null,{constructor:function(){this.ws=null;this.reqId=0;this.openReq={};this.updateId=null;this.docLoaded=!1;this._createWS();this._logLoadingError=!0},documentLoaded:function(){console.log("DOCUMENT ONLOAD");
new FIRMOS.Menu({contextMenuForWindow:!0});this.docLoaded=!0},_createWS:function(){this.ws=new WebSocket(("https:"==document.location.protocol?"wss://":"ws://")+window.location.hostname+":"+window.location.port+"/FirmOS_FRE_WS","FirmOS-FREDB-NEW");this.ws.binaryType="arraybuffer";this.ws.onmessage=this.wsMessageListener.bind(this);this.ws.onclose=this.wsCloseListener.bind(this);this.ws.onerror=this.wsErrorListener.bind(this);this.ws.onopen=this.wsOpenListener.bind(this)},callServerFunction:function(a,
b,c,d,e,f,g){var h=G_UI_COM.beforeCallServerFunction(a,b,c,d);if(!h.abort)if(h.uidPath&&(c=h.uidPath),h.params&&(d=h.params),this.docLoaded)if(1!=this.ws.readyState)switch(this.ws.readyState){case 0:console.log("WS CONNECTING => WAIT");setTimeout(this.callServerFunction.bind(this,a,b,c,d,e,f,g),10);break;case 2:console.log("WS CLOSING => WAIT");setTimeout(this.callServerFunction.bind(this,a,b,c,d,e,f,g),100);break;case 3:console.log("WS CLOSED => RECREATE"),this._createWS()}else console.log("WS OK => CALL"),
console.log(a+" - "+b+" - "+c+" - "+JSON.stringify(d)+" - BLOB: "+("undefined"!=typeof g)+" - STATE: "+this.ws.readyState),a={cn:a,fn:b,uidPath:c,rId:this.reqId,rType:"S"},f&&(a.cId=f),d&&(a.params=d),d=dojo.toJson(a),e||(e=this.handleServerFunctionResponse.bind(this)),this.openReq[this.reqId]={fn:e,uiState:G_UI_COM.getUIState(),messageObj:a},"undefined"==typeof g?this.ws.send(this.encodeString2Message(d)):(e=this.encodeString2Message(d),d=new Uint8Array(4),f=e.length,d[3]=f>>24,d[2]=f>>16&255,d[1]=
f>>8&255,d[0]=f&255,this.ws.send(new Blob([d,e,g]))),G_UI_COM.clearUIState(),this.reqId++;else this._logLoadingError&&(console.log("DOCUMENT LOADING => WAIT"),this._logLoadingError=!1),setTimeout(this.callServerFunction.bind(this,a,b,c,d,e,f,g),10)},handleAsyncServerRequest:function(a){this.handleServerFunctionResponse({},!0,a,G_UI_COM.getUIState())},handleSyncServerRequest:function(a){this.handleServerFunctionResponse({},!0,a,G_UI_COM.getUIState());a=dojo.toJson({rId:a.rid,rType:"SR"});this.ws.send(this.encodeString2Message(a))},
handleServerFunctionResponse:function(a,b,c,d){if(b){if(""!=c.output)switch(b=dojo.fromJson(c.output),b.actiontype){case "jsupdate":case "jsexecute":G_UI_COM.restoreUIState(d);this.updateId="";a.cId&&(this.updateId=a.cId);"undefined"!=typeof b.updateid&&""!=b.updateid&&(this.updateId=b.updateid);G_UI_COM.clearUpdateArea(b.id);eval(b.action);break;default:console.error("Server Function Error => Unknown action type: "+b.actiontype)}}else console.error("Server Function Error => "+c.cn+"."+c.fn+": "+
c.error)},wsMessageListener:function(a){a=dojo.fromJson(this.decodeMessage2String(a.data));a.session&&this.storeSessionId(a.session);if(a.error)this.openReq[a.rid].fn(this.openReq[a.rid].messageObj,!1,a,this.openReq[a.rid].uiState);else switch(a.rtype){case "SR":this.openReq[a.rid]?(this.openReq[a.rid].fn(this.openReq[a.rid].messageObj,!0,a,this.openReq[a.rid].uiState),delete this.openReq[a.rid]):console.error(" Error => Got answer for unknown request id: "+a.rid);break;case "S":this.handleSyncServerRequest(a);
break;case "A":this.handleAsyncServerRequest(a);break;default:console.error(" Error => Unknown Server Request Type: "+a.rtype)}},wsCloseListener:function(a){console.log("WS CLOSE "+JSON.stringify(a))},wsErrorListener:function(a){console.log("WS ERROR "+JSON.stringify(a))},wsOpenListener:function(a){console.log("WS OPEN "+JSON.stringify(a));this.callServerFunction("FIRMOS","init")},encodeString2Message:function(a){return a},decodeMessage2String:function(a){return a},storeSessionId:function(a){sessionStorage.setItem("sessionId",
a)},getSessionId:function(){return sessionStorage.getItem("sessionId")}});dojo.declare("FIRMOS.uiHandler",null,{constructor:function(a){this.clearUIState();this.dialog_=[];this.uiState_={};this.showSectionPathInProgress=!1;this.stores_={};this.formDBOs_={};this.selDepFuncs_={views:{},classes:{}};this.liveCharts_={};this.msgProgress_={};this.createdCSSRules_={};this.serverCom=a;this.buttonClickStates_={};this.sitemap_=null;this.storeDepData={}},refreshView:function(a){a.isInstanceOf(FIRMOS.GridBase)?
a.refresh():a.isInstanceOf(FIRMOS.Tree)?a.refresh():console.error("REFRESH VIEW TYPE UNKNOWN")},refreshStore:function(a){a=G_UI_COM.getStoreById(a);for(var b=0;b<a.views.length;b++)G_UI_COM.refreshView(a.views[b])},setMenu:function(a){this.menu_=a},isDialogAction:function(){this.dialogAction_=!0},setGridDetailsId:function(a){this.gridDetailsId_=a},setDropCoords:function(a){this.dropCoords_=a},getUIState:function(){return{dialogAction:this.dialogAction_,dialog:this.dialog_,menu:this.menu_,gridDetailsId:this.gridDetailsId_,
dropCoords:this.dropCoords_}},clearUIState:function(){this.dialogAction_=!1;this.dropCoords_=this.gridDetailsId_=this.menu_=null},restoreUIState:function(a){this.uiState_=a},closeDialog:function(){0<this.uiState_.dialog.length&&0<this.dialog_.length&&this.uiState_.dialog[this.uiState_.dialog.length-1].id==this.dialog_[this.dialog_.length-1].id&&this.dialog_[this.dialog_.length-1].hide(!0)},dialogLoaded:function(a){this.uiState_.dialogAction&&this.closeDialog();this.dialog_.push(a);a.show()},dialogClosed:function(a){if(this.dialog_[this.dialog_.length]==
a)this.dialog_.pop();else{for(var b=[],c=0;c<this.dialog_.length;c++)this.dialog_[c].id!=a&&(b[b.length]=this.dialog_[c]);this.dialog_=b}},showMessage:function(a){a.show();this.dialog_.push(a)},setWinTitle:function(a){a&&""!=a&&(document.title=a)},clearContentArea:function(a){this.serverCom.updateId=a;this.clearUpdateArea("");this.contentLoaded(new dijit.layout.ContentPane({}))},clearUpdateArea:function(a){if(""!=a){var b=dijit.byId(a);""==this.serverCom.updateId&&b&&(this.serverCom.updateId=a)}if(""!=
this.serverCom.updateId)if("FirmOSViewport"==this.serverCom.updateId)for(var b=dojo.byId("FirmOSViewport"),b=dijit.findWidgets(b),c=0;c<b.length;c++)b[c].destroyRecursive();else if(b=dijit.byId(this.serverCom.updateId)){c=b.getParent();if(c.isInstanceOf(dijit.layout.TabContainer)||c.isTCElem)return;if(b._contentId)var d=b._contentId;else d=b.id,this.serverCom.updateId=c.id,b=c;if(c=dijit.byId(d))c.region&&(b.updatingRegion_=c.region,b.updatingStyle_=c.style),b.removeChild(c),c.destroyRecursive()}(b=
dijit.byId(a))&&b.destroyRecursive()},contentLoaded:function(a,b){this.setWinTitle(b);this.uiState_.dialogAction&&this.closeDialog();if("FirmOSViewport"==this.serverCom.updateId){var c=dojo.byId("FirmOSViewport");a.placeAt(c);a.startup()}else(c=dijit.byId(this.serverCom.updateId))?(c.getParent(),c.updatingRegion_&&(a.set("region",c.updatingRegion_),delete c.updatingRegion_,a.set("style",c.updatingStyle_),delete c.updatingStyle_),c.isInstanceOf(dijit.layout.ContentPane)?c.set("content",a):c.addChild(a),
c._contentId&&(c._contentId=a.id),a.startup()):(console.error("NO CONTENT AREA FOUND FOR "+a.id),a.destroyRecursive());this.serverCom.updateId=null},formProxyLoaded:function(a){console.error("IMPLEMENT ME")},menuLoaded:function(a){if(0<a.length)if(this.uiState_.menu)this.uiState_.menu.entriesLoaded(a);else if(this.uiState_.dropCoords){var b=new FIRMOS.Menu;b.setCoords(this.uiState_.dropCoords.x,this.uiState_.dropCoords.y);b.entriesLoaded(a)}},updateStore:function(a,b){var c=this.getStoreById(a);c&&
(b.updated&&c.store.updateItems(b.updated),b.deleted&&c.store.deleteItems(b.deleted),b["new"]&&c.store.newItems(b["new"]))},registerStore:function(a){this.stores_[a.id]?this.stores_[a.id].store=a:this.stores_[a.id]={store:a,views:[]}},unregisterStore:function(a){delete this.stores_[a.id]},registerFormDBOs:function(a,b){this.formDBOs_[a.id]?console.error("Form "+a.id+" already registered"):this.formDBOs_[a.id]={form:a,ids:b}},unregisterFormDBOs:function(a,b){this.formDBOs_[a]?(G_SERVER_COM.callServerFunction("FIRMOS",
"unregisterDBO",null,{ids:b}),delete this.formDBOs_[a]):console.error("Form "+a+" not registered")},updateFormDBO:function(a){for(var b in this.formDBOs_)for(var c=0;c<this.formDBOs_[b].ids.length;c++)if(this.formDBOs_[b].ids[c]==a.uid){this.formDBOs_[b].form.updateValues(a);break}},updateForm:function(a,b){var c=dijit.byId(a+"_form");c&&c.isInstanceOf(FIRMOS.Form)&&c.updateValues(b)},registerSelDepFunc:function(a,b,c){this.selDepFuncs_.views[c.id]=c;this.selDepFuncs_.classes[a]||(this.selDepFuncs_.classes[a]=
{});this.selDepFuncs_.classes[a][b]||(this.selDepFuncs_.classes[a][b]={viewIds:{}});this.selDepFuncs_.classes[a][b].viewIds[c.id]=!0},unregisterSelDepFunc:function(a,b,c){this.selDepFuncs_.classes[a]&&this.selDepFuncs_.classes[a][b]&&(delete this.selDepFuncs_.classes[a][b].viewIds[c.id],0==Object.keys(this.selDepFuncs_.classes[a][b].viewIds).length&&(delete this.selDepFuncs_.classes[a][b].viewIds,0==Object.keys(this.selDepFuncs_.classes[a][b]).length&&(delete this.selDepFuncs_.classes[a][b],0==Object.keys(this.selDepFuncs_.classes[a]).length&&
delete this.selDepFuncs_.classes[a])));delete this.selDepFuncs_.views[c.id]},beforeCallServerFunction:function(a,b,c,d){var e={};if(this.selDepFuncs_.classes[a]&&this.selDepFuncs_.classes[a][b]){var f=[],g;for(g in this.selDepFuncs_.classes[a][b].viewIds)a=this.selDepFuncs_.views[g],f=f.concat(a.getSelectedIds()),dojo.mixin(d,a.contentParmas);c||1==f.length?(e.uidPath=c||[f[0]],d.selected=f,e.params=d):((c=dijit.byId(this.parentId).getParent()._contentId)&&G_UI_COM.clearContentArea(c),e.abort=!0)}return e},
registerLiveChart:function(a){this.liveCharts_[a.id]=a},unregisterLiveChart:function(a){delete this.liveCharts_[a.id]},updateLiveChart:function(a,b,c){this.liveCharts_[a]?this.liveCharts_[a].setData(b,c):console.error("updateLiveChart: "+a+" chart not found")},redefineLiveChart:function(a,b){this.liveCharts_[a]?this.liveCharts_[a].redefine(b):console.error("redefineLiveChart: "+a+" chart not found")},registerMsgProgress:function(a,b){this.msgProgress_[a]=b},unregisterMsgProgress:function(a){delete this.msgProgress_[a]},
updateMsgProgress:function(a,b){this.msgProgress_[a]?this.msgProgress_[a].updateProgress(b):console.error("updateMsgProgress: "+a+" message progress not registered")},registerStoreView:function(a,b){if(this.getStoreById(a)){for(var c=!1,d=0;d<this.stores_[a].views.length;d++)this.stores_[a].views[d].id==b.id&&(c=!0,this.stores_[a].views[d]=b);c||(this.stores_[a].views[this.stores_[a].views.length]=b)}else console.error("registerStoreView: "+a+" store not registered")},unregisterStoreView:function(a,
b){if(this.getStoreById(a)){for(var c=0;c<this.stores_[a].views.length;c++)if(this.stores_[a].views[c].id==b.id){this.stores_[a].views.splice(c,1);break}0==this.stores_[a].views.length&&this.stores_[a].store.destroy()}},getStore:function(a,b){var c=G_UI_COM.getStoreById(a);if(c)return c.store;this.storeDepData[a]&&(b._dependency=this.storeDepData[a],delete this.storeDepData[a]);return new FIRMOS.Store(b)},setStoreDepData:function(a,b){this.storeDepData[a]=b},setStoreDependency:function(a,b,c,d,e){var f=
{};f.filterfieldname=b;f.filtervalues=d;f.filterfieldtype=c;e&&(f.numfiltertype=e);(c=this.getStoreById(a))?c.store.params_.dependency[b+"_ref"]=f:(this.storeDepData[a]||(this.storeDepData[a]={}),this.storeDepData[a][b+"_ref"]=f)},deleteStoreDependency:function(a,b){var c=this.getStoreById(a);c?delete c.store.params_.dependency[b+"_ref"]:this.storeDepData[a]&&(delete this.storeDepData[a][b+"_ref"],0==Object.keys(this.storeDepData[a]).length&&delete this.storeDepData[a])},getStoreById:function(a){return this.stores_[a]},
invalidateSessionData:function(a){for(var b=0;b<a.length;b++){var c=this.getStoreById(a[b].storeid).store;if(a[b].queryids){a[b].queryids instanceof Array||(a[b].queryids=[a[b].queryids]);for(var d=0;b<a[d].queryids.length;d++)c.invalidateObserver(a[b].queryids[d])}else c.invalidateAllObservers()}},sortFuncSubSecOrd:function(a,b){return a._subSecOrd<b._subSecOrd?-1:a._subSecOrd>b._subSecOrd?1:0},createCSSRule:function(a,b){this.createdCSSRules_[a]||(dojox.html.insertCssRule("."+a,b),this.createdCSSRules_[a]=
b)},removeCSSRule:function(a){this.createdCSSRules_[a]&&(dojox.html.removeCssRule("."+a,this.createdCSSRules_[a]),delete this.createdCSSRules_[a])},toggleFormGroupStatus:function(a,b){var c=dojo.byId(b+"_tl"),d=dojo.byId(b+"_tr");if(dojo.hasClass(c,"firmosFormGroupShowLeft")){var e="";dojo.removeClass(c,"firmosFormGroupShowLeft");dojo.removeClass(d,"firmosFormGroupShowRight");dojo.addClass(c,"firmosFormGroupHideLeft");dojo.addClass(d,"firmosFormGroupHideRight")}else e="none",dojo.removeClass(c,"firmosFormGroupHideLeft"),
dojo.removeClass(d,"firmosFormGroupHideRight"),dojo.addClass(c,"firmosFormGroupShowLeft"),dojo.addClass(d,"firmosFormGroupShowRight");c=dojo.byId(a);c=dojo.query('tr[firmosGroup~="'+b+'"]',c);for(d=0;d<c.length;d++)dojo.style(c[d],"display",e)},addMenuEntries:function(a,b,c){for(var d=!0,e=0;e<b.length;e++){var f={};f.label=b[e].caption;f.disabled=b[e].disabled||c;if(b[e].icon){var g=b[e].icon.replace(/[\/\.]/g,"");G_UI_COM.createCSSRule(g,"background-image: url('"+b[e].icon+"');background-repeat: no-repeat; height: 18px;text-align: center;width: 18px;");
f.iconClass=g}if(b[e].menu){g={};b[e].id&&(g.id=b[e].id);g=new dijit.Menu(g);f.disabled=this.addMenuEntries(g,b[e].menu,f.disabled)||f.disabled;f.popup=g;var h=new dijit.PopupMenuItem(f);g._parentUIElement=h;a.addChild(h)}else b[e].id&&(f.id=b[e].id),b[e].action&&(f._action=b[e].action,f.onClick=function(){G_SERVER_COM.callServerFunction(this._action["class"],this._action.func,this._action.uidPath,this._action.params)}),b[e].downloadId&&(f._downloadId=b[e].downloadId,f.onClick=function(){dojo.io.iframe.setSrc(dojo.byId("FirmOSDownload"),
this._downloadId,!0)}),a.addChild(new dijit.MenuItem(f));d=d&&f.disabled}return d},_handleTabContainer:function(a,b,c,d){c.shift();if(0<c.length)b=1==c.length,this.showSectionPath(a,c,d)||console.error("Could not resolve given sub section path: container: "+a.id+", sections: "+JSON.stringify(c)),b&&(G_UI_COM.showSectionPathInProgress=!1);else if(d&&(a=a.getChildren()[0])&&a.isInstanceOf(FIRMOS.MultiContentContainer))for(c=a.getChildren(),d=0;d<c.length;d++)if(c[d].id==a.selectedChildWidget.id){d==
c.length-1?a.selectChild(c[0].id):a.selectChild(c[d+1].id);break}},showSectionPath:function(a,b,c){if("string"==typeof a){if("FirmOSViewport"==a)var d=dojo.byId("FirmOSViewport"),d=dijit.byId(d.children[0].id);else d=dijit.byId(a);d||console.error('Base container "'+a+'" not found.')}else d=a;if(d.isInstanceOf(dijit.layout.ContentPane))return d.hasChildren()?this.showSectionPath(d.getChildren()[0],b,c):!1;if(d.isInstanceOf(dijit.layout.BorderContainer)){a=d.getChildren();for(d=0;d<a.length;d++)if(this.showSectionPath(a[d],
b,c))return!0;return!1}if(d.isInstanceOf(FIRMOS.TabContainer)){var e=d.getChild(b[0]);if(e)return c=c&&d.selectedChildWidget.id==b[0],d.selectChild(e,this._handleTabContainer.bind(this,e,a,b,c)),!0;d.selectDefault();return!1}},registerSitemap:function(a){this.sitemap_=a},unregisterSitemap:function(a){delete this.sitemap_},_updateElement:function(a,b){a.set("disabled",b);a._parentUIElement&&a._parentUIElement.set("disabled",b)},_updateChildElements:function(a,b){if(a.isInstanceOf(dijit.Menu)||a.isInstanceOf(dijit.DropDownMenu)||
a.isInstanceOf(dijit.PopupMenuItem))for(var c=a.isInstanceOf(dijit.PopupMenuItem)?a.popup.getChildren():a.getChildren(),d=0;d<c.length;d++)this._updateElement(c[d],b),this._updateChildElements(c[d],b)},_updateParent:function(a){a=a._parentUIElement?a._parentUIElement.getParent():a.getParent();if(a.isInstanceOf(dijit.Menu)||a.isInstanceOf(dijit.DropDownMenu)){for(var b=a.getChildren(),c=!0,d=0;d<b.length;d++)if(!b[d].get("disabled")){c=!1;break}a.get("disabled")!=c&&(this._updateElement(a,c),this._updateParent(a))}},
updateUIElement:function(a,b,c){if(a=dijit.byId(a))this._updateElement(a,b),""!=c&&a.set("label",c),this._updateChildElements(a,b),this._updateParent(a)},updateUIElementSubmenu:function(a,b){var c=dijit.byId(a);if(c){c.destroyDescendants();var d=G_UI_COM.addMenuEntries(c,b,c.get("disabled"));this._updateElement(c,d)}},openUrl:function(a,b){b?window.open(a)||alert(G_TEXTS.openWindow.error):document.location.href=a}});G_SERVER_COM=new FIRMOS.wsConnectionHandler;G_UI_COM=new FIRMOS.uiHandler(G_SERVER_COM);
dojo.declare("FIRMOS.Dialog",dijit.Dialog,{onShow:function(){this.closable||dojo.style(this.closeButtonNode,"display","none")},hide:function(a){if(this.closable||a)G_UI_COM.dialogClosed(this.id),this.destroyRecursive()}});dojo.declare("FIRMOS.Message",FIRMOS.Dialog,{texts:G_TEXTS.msg,closable:!1,destroy:function(){this.progressBarId&&G_UI_COM.unregisterMsgProgress(this.progressBarId);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);var a;switch(this.type){case "msg_error":case "msg_warning":case "msg_info":case "msg_confirm":case "msg_wait":a=
"Wait"}var b='<div class="firmosMessageIcon'+a+'"></div><div class="firmosMessage'+a+'">'+this.msg+"</div>";this.progressBarId&&(b=b+'<div class="firmosMessageProgressBar" id="'+this.id+'_pb"></div>');b=b+'<div class="firmosMessageButtons'+a+'" id="'+this.id+'_buttons"></div>';this.set("content",b);switch(this.type){case "msg_error":case "msg_warning":case "msg_info":a=new dijit.form.Button({type:"button",label:this.texts.ok,onClick:this._onClick.bind(this)});a.placeAt(dojo.byId(this.id+"_buttons"));
break;case "msg_confirm":a=new dijit.form.Button({type:"button",label:this.texts.yes,onClick:this._onClick.bind(this,!0)});a.placeAt(dojo.byId(this.id+"_buttons"));a=new dijit.form.Button({type:"button",label:this.texts.no,onClick:this._onClick.bind(this,!1)});a.placeAt(dojo.byId(this.id+"_buttons"));break;case "msg_wait":this.sfClassname&&(a=new dijit.form.Button({type:"button",label:this.texts.abort,onClick:this._onClick.bind(this)}),a.placeAt(dojo.byId(this.id+"_buttons")))}this.progressBarId&&
(G_UI_COM.registerMsgProgress(this.progressBarId,this),this._pb=new dijit.ProgressBar({style:"width: 100%"}),this._pb.set("value",0),this._pb.set("label","0%"),this._pb.placeAt(dojo.byId(this.id+"_pb")))},updateProgress:function(a){this._pb.set("value",a);this._pb.set("label",Math.round(a)+"%")},_onClick:function(a){this.hide(!0);if(this.sfClassname){var b=dojo.clone(this.sfParams);"boolean"==typeof a&&(b.confirmed=a);G_SERVER_COM.callServerFunction(this.sfClassname,this.sfFunctionname,this.sfUidPath,
b)}}});dojo.declare("FIRMOS.Store",null,{idAttribute:"uid",labelAttributes:["text","objname","uid"],constructor:function(a){this.params_={};a._dependency?(this.params_.dependency=a._dependency,delete a._dependency):this.params_.dependency={};for(var b in a)this[b]=a[b];this._index={};this._dirtyItems={};this._orgItems={};this.queryId_=0;this.queryResults_={};G_UI_COM.registerStore(this)},destroy:function(){this.destroyClassname&&G_SERVER_COM.callServerFunction(this.destroyClassname,this.destroyFunctionname,
this.destroyUidPath,this.destroyParams);G_UI_COM.unregisterStore(this);G_UI_COM.setStoreDepData(this.id,this.params_.dependency);this.inherited(arguments)},close:function(a){return a&&a.abort&&a.abort()},containsValue:function(a,b,c){return-1<dojo.array.indexOf(this.getValues(a,b),c)},mayHaveChildren:function(a){return a.children?!0:!1},_getChildrenCallback:function(a,b,c){a.children=c;for(c=0;c<a.children.length;c++)this._index[this.getIdentity(a.children[c])]=!0,a.children[c].children&&"UNCHECKED"==
a.children[c].children&&(a.children[c].children=[],a.children[c]._loadChildren=!0);b(a)},getChildren:function(a,b){var c="function"==typeof b,d={};c||(d=b);d=this._doQuery(d,a);c&&(d.addCallback(this._getChildrenCallback.bind(this,a,b)),d.addErrback(b.bind(this,Error("Error in function getChildren"))));return dojo.store.util.QueryResults(d)},query:function(a,b){b.query=a;var c=this._doQuery(b);return dojo.store.util.QueryResults(c)},_doQuery:function(a,b){var c=new dojo.Deferred,d=this.queryId_++;
this.queryResults_[d]={};this.queryResults_[d].query=a.query;this.queryResults_[d].queryArgs=a;this.queryResults_[d].dataIds=[];this.queryResults_[d].observer=[];this.queryResults_[d].observerInfo=[];var e=dojo.clone(this.getParams);dojo.mixin(e,this.params_);if(b){this.queryResults_[d].parentId=this.getIdentity(b);var f=this.getIdentity(b);e.parentid=f}if(b&&b._childrenfunc_)var f=b._funcclassname_||this.getClassname,g=b._childrenfunc_,h=b.uidpath?b.uidpath instanceof Array?b.uidpath:[b.uidpath]:
[b.uid];else this.queryResults_[d].parentId="",h=this.getUidPath,f=this.getClassname,g=this.getFunctionname;e.queryid=d;a.query&&(e.query=a.query);"undefined"!=typeof a.count&&(e.count=a.count);"undefined"!=typeof a.start&&(e.start=a.start);if(a.sort){e.sort=[];for(var k=0;k<a.sort.length;k++)e.sort[k]={},e.sort[k].property=a.sort[k].attribute,e.sort[k].ascending=!a.sort[k].descending}c.total=new dojo.Deferred;c.observe=this._observe.bind(this,d);d=function(a,b,d,e){if(d)if(b=dojo.fromJson(e.output),
b.actiontype&&"jsexecute"==b.actiontype)c.reject(),eval(b.action);else{c.total.resolve(b.total);if(this.queryResults_[a]){for(d=0;d<b.data.length;d++)this.queryResults_[a].dataIds.push(this.getIdentity(b.data[d]));0==this.queryResults_[a].observer.length&&setTimeout(this._deleteResultCache.bind(this,a),2E3)}c.resolve(b.data)}else c.reject(e.error)}.bind(this,d);G_SERVER_COM.callServerFunction(f,g,h,e,d);return c},_fetchTotalCountCallback:function(a,b,c){a.onBegin&&a.onBegin.call(b,c,a)},_fetchCallback:function(a,
b,c){for(var d=0;d<c.length;d++)this._index[this.getIdentity(c[d])]=!0;if(a.onItem)for(d=0;d<c.length;d++)a.onItem.call(b,c[d],a);a.onComplete&&a.onComplete.call(b,a.onItem?null:c,a)},fetch:function(a){a=a||{};var b=a.scope||this,c=this._doQuery(a);c.request=a;c.addCallback(this._fetchCallback.bind(this,a,b));c.total.addCallback(this._fetchTotalCountCallback.bind(this,a,b));a.onError&&c.addErrback(function(c){return a.onError.call(b,c,a)});a.abort=function(){c.cancel()};return a},getAttributes:function(a){var b=
[],c;for(c in a)!a.hasOwnProperty(c)||"_"==c.charAt(0)&&"_"==c.charAt(1)||b.push(c);return b},getFeatures:function(){return{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0,"dojo.data.api.Write":!0,"dojo.data.api.Notification":!0}},getLabel:function(a){for(var b=0;b<this.labelAttributes.length;b++){var c=this.getValue(a,this.labelAttributes[b]);if(c)return c}for(b in a)return a[b]},getLabelAttributes:function(a){return this.labelAttributes},getValue:function(a,b,c){if(b in a)return a[b];if(!a._loadChildren||
"children"!=b)return c},getValues:function(a,b){var c=this.getValue(a,b);return c instanceof Array?c:void 0===c?[]:[c]},hasAttribute:function(a,b){return b in a},isItem:function(a){return"object"==typeof a&&a&&void 0!=this.getIdentity(a)},isItemLoaded:function(a){return a&&!a._loadChildren},_loadItemCallback:function(a,b){var c=a.scope||this;delete b._loadChildren;var d=b instanceof Error?a.onError:a.onItem;d&&d.call(c,b)},loadItem:function(a){var b=a.scope||this;a.item._loadChildren?this.getChildren(a.item,
this._loadItemCallback.bind(this,a)):a.onItem&&a.onItem.call(b,a.item)},deleteItem:function(a){console.error("STORE DELETE NOT IMPLEMENTED: "+JSON.stringify(a));return!0},isDirty:function(a){return this._dirtyItems[this.getIdentity(a)]?!0:!1},newItem:function(a,b){console.error("STORE NEW ITEM NOT IMPLEMENTED: "+JSON.stringify(a)+" - "+JSON.stringify(b));return a},revert:function(){for(var a in this._dirtyItems){for(var b in this._dirtyItems[a])if(this._orgItems[a][b]!=this._dirtyItems[a][b])this.onSet(this._orgItems[a],
b,this._dirtyItems[a][b],this._orgItems[a][b]);delete this._dirtyItems[a];delete this._orgItems[a]}},save:function(a){console.error("SAVE ITEM NOT IMPLEMENTED: "+JSON.stringify(a));var b=a.scope||this,c;for(c in this._dirtyItems)delete this._dirtyItems[c],delete this._orgItems[c];a.onComplete&&a.onComplete.call(b,a)},setValue:function(a,b,c){if(b==this.idAttribute)throw Error("Can not change the identity attribute for an item");var d=a[b];d!=c&&(this._orgItems[this.getIdentity(a)]||(this._orgItems[this.getIdentity(a)]=
dojo.clone(a)),c?a[b]=c:delete a[b],this._dirtyItems[this.getIdentity(a)]=a,this.onSet(a,b,d,c))},setValues:function(a,b,c){if(!lang.isArray(c))throw Error("setValues expects to be passed an Array object as its value");this.setValue(a,b,c)},unsetAttribute:function(a,b){this.setValue(a,b)},onSet:function(a,b,c,d){},onNew:function(a,b){},onDelete:function(a){},fetchItemByIdentity:function(a){return this.fetch({query:this.idAttribute+"="+a.identity,onComplete:a.onItem,onError:a.onError,scope:a.scope})},
getIdentity:function(a){return a[this.idAttribute]},getIdentityAttributes:function(a){return[this.idAttribute]},_observe:function(a,b,c,d){c={};c.listener=b;c.remove=c.cancel=this._removeObserver.bind(this,c);c.queryId=a;this.queryResults_[a].observer.push(b);this.queryResults_[a].observerInfo.push(d||"");return c},invalidateObserver:function(a){delete this.queryResults_[a]},invalidateAllObservers:function(){for(var a in this.queryResults_)delete this.queryResults_[a]},_removeObserver:function(a){if(this.queryResults_[a.queryId]){if(0==
this.queryResults_[a.queryId].dataIds.length)return;var b=dojo.array.indexOf(this.queryResults_[a.queryId].observer,a.listener);-1<b&&(this.queryResults_[a.queryId].observer.splice(b,1),this.queryResults_[a.queryId].observerInfo.splice(b,1))}this._deleteResultCache(a.queryId)},_deleteResultCache:function(a){if(this.queryResults_[a]&&0==this.queryResults_[a].observer.length){if(this.clearClassname){var b=this.clearParams;b.queryid=a;G_SERVER_COM.callServerFunction(this.clearClassname,this.clearFunctionname,
this.clearUidPath,b)}delete this.queryResults_[a]}},get:function(a){var b={};b[this.idAttribute]=a;return b},remove:function(a){if(this.dragClassname){var b=dojo.clone(this.dragParams);dojo.mixin(b,this.params_);b.selected=a;G_SERVER_COM.callServerFunction(this.dragClassname,this.dragFunctionname,this.dragUidPath,b)}},put:function(a,b){if(this.dropClassname){var c=dojo.clone(this.dropParams);dojo.mixin(c,this.params_);c.selected=[];for(var d=0;d<a.length;d++)c.selected.push(this.getIdentity(a[d]));
b.before&&(c.target=b.source?b.source.getIdentity(b.before):this.getIdentity(b.before));b.mousePos&&G_UI_COM.setDropCoords(b.mousePos);G_SERVER_COM.callServerFunction(this.dropClassname,this.dropFunctionname,this.dropUidPath,c)}},_findItemInResultSets:function(a){var b=[],c;for(c in this.queryResults_)for(var d=0;d<this.queryResults_[c].dataIds.length;d++)if(this.queryResults_[c].dataIds[d]==a){b.push({queryId:c,pos:d});break}return b},_findChildrenCallResultSets:function(a){var b=[],c;for(c in this.queryResults_)this.queryResults_[c].parentId==
a&&b.push({queryId:c});return b},_removeChildrenQuerys:function(a){for(var b in this.queryResults_)if(this.queryResults_[b].parentId==a){for(var c=0;c<this.queryResults_[b].dataIds.length;c++)this._removeChildrenQuerys(this.queryResults_[b].dataIds[c]);delete this.queryResults_[b]}},newItems:function(a){for(var b=0;b<a.length;b++){var c=this._findItemInResultSets(this.getIdentity(a[b].item));if(0<c||this._index[this.getIdentity(a[b].item)])console.error("NEW ITEMS: Item "+this.getIdentity(a[b].item)+
" already in store!");else if(0==this._findChildrenCallResultSets(a[b].parentid).length)console.error("NEW ITEMS: Parent "+a[b].parentid+" not found or no children retrieved yet!");else if(""!=a[b].revid){var d=!0,c=this._findItemInResultSets(a[b].revid);if(0<c.length)for(var e=0;e<c.length;e++)if(a[b].parentid==this.queryResults_[c[e].queryId].parentId)for(var d=!1,f=this.queryResults_[c[e].queryId].observer.length,g=0;g<f;g++)a[b].revisprev&&(c[e].pos+=1),this.queryResults_[c[e].queryId].dataIds.splice(c[e].pos,
0,this.getIdentity(a[b].item)),this.queryResults_[c[e].queryId].observer[g](a[b].item,-1,c[e].pos);this._index[a[b].revid]&&(d=!1,this._index[this.getIdentity(a[b].item)]=!0,this.onNew(a[b].item));d&&(""!=a[b].parentid?console.error("RevId "+a[b].revid+" not found in any query for parent item "+a[b].parentid):console.error("RevId "+a[b].revid+" not found in any query"))}else{for(e in this.queryResults_)if(a[b].parentid==this.queryResults_[e].parentId)for(g=0;g<this.queryResults_[e].observer.length;g++)this.queryResults_[e].dataIds.unshift(this.getIdentity(a[b].item)),
this.queryResults_[e].observer[g](a[b].item,-1,0);this._index[this.getIdentity(a[b].item)]=!0;this.onNew(a[b].item)}}},deleteItems:function(a){for(var b=0;b<a.length;b++){var c=!0,d={};d[this.idAttribute]=a[b];var e=this._findItemInResultSets(a[b]);if(0<e.length)for(var c=!1,f=0;f<e.length;f++){this._removeChildrenQuerys(a[b]);this.queryResults_[e[f].queryId].dataIds.splice(e[f].pos,1);for(var g=this.queryResults_[e[f].queryId].observer.length,h=0;h<g;h++)this.queryResults_[e[f].queryId].observer[h](d,
e[f].pos,-1)}this._index[a[b]]&&(noFound=!1,delete this._index[a[b]],this.onDelete(d));c&&console.error("DeleteId "+a[b]+" not found in any query")}},updateItems:function(a){for(var b=!0,c=[],d=0;d<a.length;d++){var e=this._findItemInResultSets(this.getIdentity(a[d]));if(0<e.length)for(var b=!1,f=0;f<e.length;f++)for(var g=this.queryResults_[e[f].queryId].observer.length,h=0;h<g;h++)if(this.queryResults_[e[f].queryId].observerInfo[h]){for(var k=G_UI_COM.getStoreById(this.id).views,l=0;l<k.length;l++)if(k[l].id==
this.queryResults_[e[f].queryId].observerInfo[h]){k=k[l].storeAdapters_;for(l=0;l<k.length;l++)if(k[l].series.name==this.queryResults_[e[f].queryId].query.sId){k[l].objects[e[f].pos].value=a[d].value;break}break}-1==dojo.array.indexOf(c,this.queryResults_[e[f].queryId].observer[h])&&c.push(this.queryResults_[e[f].queryId].observer[h])}else this.queryResults_[e[f].queryId].observer[h](a[d],e[f].pos,e[f].pos);if(this._index[this.getIdentity(a[d])]){var b=!1,m;for(m in a[d])if(m!=this.idAttribute)this.onSet(a[d],
m,"",a[d][m])}b&&console.error("UpdateId "+this.getIdentity(a[d])+" not found in any query")}for(d=0;d<c.length;d++)c[d]()}});dojo.declare("FIRMOS.Tree",dijit.Tree,{constructor:function(a){G_UI_COM.registerStoreView(a.model.store.id,this)},destroy:function(){G_UI_COM.unregisterStoreView(this.model.store.id,this);this.inherited(arguments)},postCreate:function(){this.watch("selectedItems",this.selectionChanged.bind(this));this.inherited(arguments)},getIconClass:function(a,b){if(a._icon_){var c=a._icon_.replace(/[\/\.]/g,
"");G_UI_COM.createCSSRule(c,"background-image: url('"+a._icon_+"');background-repeat: no-repeat; height: 18px;text-align: center;width: 18px;");return c}return this.inherited(arguments)},selectionChanged:function(a,b,c){if(c&&0<c.length){if(c[0]._funcclassname_&&c[0]._contentfunc_){var d={};d.classname=c[0]._funcclassname_;d.functionname=c[0]._contentfunc_;d.uidPath=c[0].uidpath?c[0].uidpath instanceof Array?c[0].uidpath:[c[0].uidpath]:[c[0].uid]}d&&G_SERVER_COM.callServerFunction(d.classname,d.functionname,
d.uidPath,null,null,dijit.byId(this.parentId).getParent()._contentId||null)}},refresh:function(){this.dndController.selectNone();this.model.store.clearOnClose=!0;this.model.store.close();this._itemNodesMap={};this.rootNode.state="UNCHECKED";this.model.root.children=null;this.rootNode.destroyRecursive();this.model.constructor(this.model);this.model.root._loadChildren=!0;this.postMixInProperties();this._load()},_initState:function(){this._openedNodes={};if(this.persist&&this.cookieName){var a=sessionStorage.getItem(this.cookieName);
a&&dojo.forEach(a.split(","),function(a){this._openedNodes[a]=!0},this)}},_state:function(a,b){if(!this.persist)return!1;var c=dojo.map(a.getTreePath(),function(a){return this.model.getIdentity(a)},this).join("/");if(1===arguments.length)return this._openedNodes[c];b?this._openedNodes[c]=!0:delete this._openedNodes[c];var c=[],d;for(d in this._openedNodes)c.push(d);sessionStorage.setItem(this.cookieName,c.join(","))}});_ColumnDnDSource=dojo.declare("FIRMOS.ColumnDnDSource",dgrid.ColumnReorder.ColumnDndSource,
{onMouseDown:function(a){a.stopPropagation=function(){};this.inherited(arguments)}});dojo.declare("FIRMOS.ColumnReorder",dgrid.ColumnReorder,{columnDndConstructor:_ColumnDnDSource});_GridDnDSource=dojo.declare("FIRMOS.GridDnDSource",dgrid.DnD.GridSource,{allowNested:!0,checkAcceptance:function(a,b){for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;break}if(!e)return!1}return!0},onMouseDown:function(a){a.stopPropagation=function(){};this.inherited(arguments)},
copyState:function(a,b){return!1},getSelectedNodes:function(){if(this.grid.dndDisabled)return[];var a=[];if(!this.current)return[];var b=new dojo.NodeList,c;for(c in this.grid.selection){var d=this.grid.row(c).data;this.grid.dragClasses_&&!(d.dndclass in this.grid.dragClasses_)||d._disabledrag_?a.push(d):b.push(this._selectedNodes[c])}if(0<a.length){b="";for(c=0;c<a.length;c++)b+=", "+this.grid.store.getLabel(a[c]);b=b.substr(2);console.log("Object(s) not dragable "+b);return[]}return b},onDrop:function(a,
b,c){var d=this,e=this._targetAnchor=this.targetAnchor,f=this.grid,g=f.store,e=e&&f.row(e);dojo.Deferred.when(e&&g.get(g.getIdentity(e.data)),function(e){if(d!=a)d.onDropExternal(a,b,c,e);else d.onDropInternal(b,c,e)})},onDropInternal:function(a,b,c){var d=this.grid.store,e=this,f=[];a.forEach(function(a){f.push(e.getObject(a))});d[b&&d.copy?"copy":"put"](f,{before:c,mousePos:this.mousePos_})},onDropExternal:function(a,b,c,d){var e=this.grid.store,f=a.grid,g=[];b.forEach(function(b,c){g.push(a.getObject(b))});
e[c&&e.copy?"copy":"put"](g,{source:f.store,before:d,mousePos:this.mousePos_})},getObject:function(a){return this.grid.row(a).data},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=this.targetState){dojo.dnd.Source.superclass.onMouseMove.call(this,a);var b=dojo.dnd.Manager.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var c=this.getSelectedNodes();c.length&&b.startDrag(this,c,this.copyState(dojo.dnd.getCopyKeyState(a),
!0))}if(this.isDragging&&(this.mousePos_={x:a.pageX,y:a.pageY},c=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=dojo.domGeo.position(this.current,!0)),c=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==dojo.domGeo.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||c!=this.before))if(this._markTargetAnchor(c),this.grid.dropClassesMultiple_||this.grid.dropClassesSimple_)if(this.current)if(a=
this.grid.row(this.current).data,(this.grid.dropClassesSingle_&&a.dndclass in this.grid.dropClassesSingle_&&1==this.grid.selection_.length||this.grid.dropClassesMultiple_&&a.dndclass in this.grid.dropClassesMultiple_)&&!a._disabledrop_){for(var c=!1,d=0;d<b.nodes.length;d++)if(b.source.grid.store.getIdentity(b.source.grid.row(b.nodes[d]))==this.grid.store.getIdentity(a)){c=!0;break}c?b.canDrop(!1):b.canDrop(!0)}else b.canDrop(!1);else b.canDrop(!1);else b.canDrop(!0)}}});dojo.declare("FIRMOS.GridDnD",
dgrid.DnD,{dndAcceptType:["dgrid-row"],dndConstructor:_GridDnDSource,postMixInProperties:function(){this.inherited(arguments);this.dndParams=dojo.mixin(this.dndParams,{accept:this.dndAcceptType})}});dojo.declare("FIRMOS.GridBase",null,{constructor:function(a){if(a.dragClasses){this.dragClasses_={};for(var b=0;b<a.dragClasses.length;b++)this.dragClasses_[a.dragClasses[b]]=!0;delete a.dragClasses}if(a.dropClassesMultiple){this.dropClassesMultiple_={};for(b=0;b<a.dropClassesMultiple.length;b++)this.dropClassesMultiple_[a.dropClassesMultiple[b]]=
!0;delete a.dropClassesMultiple}if(a.dropClassesSingle){this.dropClassesSingle_={};for(b=0;b<a.dropClassesSingle.length;b++)this.dropClassesSingle_[a.dropClassesSingle[b]]=!0;delete a.dropClassesSingle}this.depStores_=[];this.buttons_=[];this.storeRefreshHandler_={};this.selection_=[];this._events=[];G_UI_COM.registerStoreView(a.store.id,this);a.selDepClassname&&(this.id=a.id,G_UI_COM.registerSelDepFunc(a.selDepClassname,a.selDepFunctionname,this))},destroy:function(){G_UI_COM.unregisterStoreView(this.store.id,
this);this.selection={};this.notifyServer();this.selDepClassname&&G_UI_COM.unregisterSelDepFunc(this.selDepClassname,this.selDepFunctionname,this);for(var a=0;a<this.depStores_.length;a++)G_UI_COM.deleteStoreDependency(this.depStores_[a].storeId,this.depStores_[a].refId);for(;0<this._events.length;)this._events.pop().remove();this.inherited(arguments)},getObjectDndType:function(a){return[this.id]},postCreate:function(){this.inherited(arguments);this._events.push(this.on(".dgrid-row:contextmenu",this.onContextMenu.bind(this)));
this._events.push(this.on("dgrid-select",this.onSelect.bind(this)));this._events.push(this.on("dgrid-deselect",this.onDeselect.bind(this)));this._events.push(dojo.aspect.after(this,"expand",this._onExpand.bind(this),!0))},getSelectedIds:function(){var a=[],b;for(b in this.selection)a.push(b);return a},_onExpand:function(a,b,c){b=dojo.query(".firmosIconNode",a.element);for(c=0;c<b.length;c++)if(2==b.length){var d=a.element?a:this.row(a);this._expanded[d.id]?(dojo.style(b[0],"display","none"),dojo.style(b[1],
"display","")):(dojo.style(b[0],"display",""),dojo.style(b[1],"display","none"))}},_renderIconCell:function(a,b,c,d,e,f){c=document.createElement("div");e="<img src='"+a[e]+"' class='firmosIconNode'>";f&&""!=f&&(e=e+"<img src='"+a[f]+"' class='firmosIconNode' style='display:none;'>");c.innerHTML=e+"&nbsp;"+b;return c},_renderDate:function(a,b,c,d){a=document.createElement("div");b&&(a.innerHTML=dojo.date.locale.format(new Date(b),{formatLength:"short"}));return a},_renderIcons:function(a,b,c,d){a=
document.createElement("div");if(!b||""==b)return"";b=b.split(",");c="";for(d=0;d<b.length;d++)c=c+'<img src="'+b[d]+'">';a.innerHTML=c;return a},_selectionChanged:function(){var a=!1,b=this.getSelectedIds();if(b.length!=this.selection_.length)a=!0;else for(var c=0;c<b.length;c++)b[c]!=this.selection_[c]&&(a=!0);a&&(this.selection_=b);return a},onSelect:function(a){if(this._selectionChanged())this.onSelectionChanged(a,this.selection_)},onDeselect:function(a){if(this._selectionChanged())this.onSelectionChanged(a,
this.selection_)},onSelectionChanged:function(a,b){this.refreshDepStores(b);this.refreshButtons(b);this.notifyServer()},updateRow:function(a,b,c,d){if(!b||b.parentNode){b=d.start+c;c=this.id+"-row-"+(d.parentId?d.parentId+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++);var e=(c=dojo.byId(c))&&c.previousSibling;e&&this.adjustRowIndices(e);c.rowIndex=b;a=this.renderRow(a,d);dojo.destroy(c.childNodes[0]);dojo.place(a.childNodes[0],c);dojo.destroy(a);return c}},renderRow:function(a,
b){var c=this.inherited(arguments);if(this.showDetailsSection){var d={params:{}};a._detailsfunc_&&a._funcclassname_?(d.classname=a._funcclassname_,d.functionname=a._detailsfunc_):this.detailsClassname&&(d.classname=this.detailsClassname,d.functionname=this.detailsFunctionname,dojo.mixin(d.params,this.detailsParams),this.detailsUidPath&&(d.uidPath=this.detailsUidPath));if(d.classname){d.params.selected=a.uidpath?a.uidpath instanceof Array?a.uidpath:[a.uidpath]:[a.uid];d.uidPath||(d.uidPath=d.params.selected);
a._detailsfunc_=d;dojo.create("div",{"class":"firmosGridDetailsHidden",id:this.store.getIdentity(a)+"_details_hidden"},c);dojo.create("div",{"class":"firmosGridDetailsLoading",id:this.store.getIdentity(a)+"_details_loading",style:"display:none;"},c);dojo.create("div",{"class":"firmosGridDetails",id:this.store.getIdentity(a)+"_details",style:"display:none;"},c);this.row(a);d=dijit.byId(this.store.getIdentity(a)+"_cc");if(!d){var d=new dijit.layout.ContentPane({id:this.store.getIdentity(a)+"_cc"}),
e=new dijit.layout.ContentPane({id:this.store.getIdentity(a)+"_cp"});d.addChild(e)}dojo.place(d.domNode,c)}}return c},showDetails:function(a){rowId=this.store.getIdentity(a.data);G_UI_COM.setGridDetailsId(rowId);var b=dijit.byId(this.store.getIdentity(a.data)+"_cc");G_SERVER_COM.callServerFunction(a.data._detailsfunc_.classname,a.data._detailsfunc_.functionname,a.data._detailsfunc_.uidPath,a.data._detailsfunc_.params,this.detailsCallback.bind(this),b.getChildren()[0].id);a=dojo.byId(rowId+"_details_hidden");
b=dojo.byId(rowId+"_details_loading");dojo.style(a,"display","none");dojo.style(b,"display","")},detailsCallback:function(a,b,c,d){G_SERVER_COM.handleServerFunctionResponse(a,b,c,d);a=dojo.byId(d.gridDetailsId+"_details_loading");b=dojo.byId(d.gridDetailsId+"_details");dojo.style(a,"display","none");dojo.style(b,"display","");d=dijit.byId(d.gridDetailsId+"_cc");dojo.style(d.domNode,"display","")},hideDetails:function(a){rowId=this.store.getIdentity(a.data);a=dojo.byId(rowId+"_details_hidden");var b=
dojo.byId(rowId+"_details");dojo.style(a,"display","");dojo.style(b,"display","none");a=dijit.byId(rowId+"_cc");dojo.style(a.domNode,"display","none")},onContextMenu:function(a){var b=this.row(a);this.contextMenu._handleGridMenu(a,this,b.data)},_refreshDepStoreViews:function(a){delete this.storeRefreshHandler_[a.store.id];for(var b=0;b<a.views.length;b++)G_UI_COM.refreshView(a.views[b])},refreshDepStore:function(a,b,c){G_UI_COM.setStoreDependency(a,b,"G",c);if(b=G_UI_COM.getStoreById(a))this.storeRefreshHandler_[a]&&
(clearTimeout(this.storeRefreshHandler_[a]),delete this.storeRefreshHandler_[a]),this.storeRefreshHandler_[a]=setTimeout(this._refreshDepStoreViews.bind(this,b),200)},refreshDepStores:function(a){for(var b=0;b<this.depStores_.length;b++)this.refreshDepStore(this.depStores_[b].storeId,this.depStores_[b].refId,a)},refreshButtons:function(a){a=a.length;for(var b=0;b<this.buttons_.length;b++)switch(this.buttons_[b].bType){case "gbd_single":1==a?this.buttons_[b].button.set("disabled",!1):this.buttons_[b].button.set("disabled",
!0);break;case "gbd_multi":0==a?this.buttons_[b].button.set("disabled",!0):this.buttons_[b].button.set("disabled",!1)}},notifyServer:function(){this.selDepClassname&&G_SERVER_COM.callServerFunction(this.selDepClassname,this.selDepFunctionname,this.selDepUidPath,this.selDepParams,null,dijit.byId(this.parentId).getParent()._contentId||null)},registerDepStore:function(a,b){this.depStores_.push({storeId:a,refId:b});this.refreshDepStore(a,b,this.selection_)},registerButton:function(a,b){this.buttons_.push({button:a,
bType:b});a.setGrid(this)},doSearch:function(a){this.store.params_.fulltext=a;this.refresh()}});dojo.declare("FIRMOS.FormButton",dijit.form.Button,{onClick:function(a){a.preventDefault();dojo.stopEvent(a);this._getWidget(dijit.form.Form).disableAllButtons();switch(this.type){case "submit":this.handleTypeSubmit();break;case "button":this.handleTypeButton()}},_getWidget:function(a){for(var b=this.getParent();b&&!b.isInstanceOf(a);)b=b.getParent();return b},handleTypeButton:function(){if(this.closeDialog){var a=
this._getWidget(dijit.Dialog);a&&a.hide()}this.actionClassname&&G_SERVER_COM.callServerFunction(this.actionClassname,this.actionFunctionname,this.actionUidPath,this.actionParams,this.sfCallback.bind(this));this.downloadId&&(dojo.io.iframe.setSrc(dojo.byId("FirmOSDownload"),this.downloadId,!0),this.closeDialog||this._getWidget(dijit.form.Form).restoreAllButtons())},handleTypeSubmit:function(){var a=this._getWidget(dijit.form.Form),b=dojo.clone(this.actionParams);a.callServerFunction(this.actionClassname,
this.actionFunctionname,this.actionUidPath,b,this.hiddenFields,this.isDialog)},sfCallback:function(a,b,c,d){this._getWidget(dijit.form.Form).restoreAllButtons();G_SERVER_COM.handleServerFunctionResponse(a,b,c,d)}});dojo.declare("FIRMOS.GridButton",dijit.form.Button,{setGrid:function(a){this.grid_=a},onClick:function(){var a={},b=this.grid_.getSelectedIds(),c;a.dependency=this.grid_.store.params_.dependency;dojo.mixin(a,this.actionParams);a.selected=b;if(this.actionUidPath)c=this.actionUidPath;else if(0<
b.length){var d=this.grid_.row(b[0]);c=[b[0]];d.uidPath?c=d.uidPath:d.uid&&(c=[d.uid])}G_SERVER_COM.callServerFunction(this.actionClassname,this.actionFunctionname,c,a)}});dojo.declare("FIRMOS.DateTextBox",dijit.form.DateTextBox,{popupClass:"dojox.widget.Calendar",constructor:function(a){a.grouprequired?(this.groupRequired=eval(a.grouprequired),delete a.grouprequired):this.groupRequired=!1},_setDisplayedValueAttr:function(a,b){isNaN(a)?this.inherited(arguments):0==Number(a)?this._setValueAttr("",
b,""):this._setValueAttr(new Date(Number(a)),b,new Date(Number(a)))},onChange:function(){this.inherited(arguments);for(var a=this.getParent();a&&!a.isInstanceOf(dijit.form.Form);)a=a.getParent();a&&a.isInstanceOf(FIRMOS.Form)&&(a.checkGroupRequiredFields(this),a.submitOnChange(this))}});dojo.declare("FIRMOS.Recurrence",dijit.form._FormValueWidget,{texts:G_TEXTS.recurrence,_selectedRadioCSS:"dijitChecked dijitRadioChecked",_selectedStr:'aria-checked="true"',_rtypeStr:"",_rtypeDetailsStr:"",_startStr:"",
_endStr:"",rtypes:"once minute hour day week month quarter year".split(" "),days:"mo tu we th fr sa su".split(" "),minuteDetails:[{label:"1",value:"1"},{label:"5",value:"5"},{label:"10",value:"10"},{label:"15",value:"15"},{label:"30",value:"30"},{label:"45",value:"45"}],hourDetails:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"6",value:"6"},{label:"12",value:"12"}],dayDetails:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",
value:"4"},{label:"5",value:"5"},{label:"6",value:"6"}],monthDetails:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"6",value:"6"}],rtypesVis:[],baseClass:"firmosRecurrenceInput",templateString:"",templateStart:'<div data-dojo-attach-point="wrapperDiv,focusNode" id="${id}" role="presentation">',templateEnd:"</div>",templateDivider:'<div class="firmosRecurrenceDividerContainer"><div class="firmosRecurrenceDivider"></div></div>',templateStartDate:'<div id="${id}_sd"></div><div id="${id}_st"></div>',
templateEndDate:'<div id="${id}_ed"></div><div id="${id}_et"></div>',templateCount:'<div id="${id}_count"></div>',templateCB:'<div data-dojo-attach-point="${value}Div" class="firmosRecurrenceInputItem" role="presentation"><div class="firmosRecurrenceCBContainer"><div class="dijit dijitReset dijitInline dojoxMultiSelectItemBox dijitRadio" role="presentation"><input class="dijitCheckBoxInput" data-dojo-type="dijit.form.CheckBox" data-dojo-attach-event="onclick:_onRadioClick, onmouseover: _onRadioMOver, onmouseout: _onRadioMOut" data-onclick="${onclick}" data-cbid="${value}" type="radio" "/></div><div class="dijitInline dojoxMultiSelectItemLabel" data-dojo-attach-event="onclick:${onclick}" data-cbid="${value}">${caption}</div></div>${details}</div>',
templateonceDetails:"",templateminuteDetails:'<div class="dijitInline" style="float:right;"><div class="dijitInline" style="margin: 0 5px;">${caption}:</div><div id="${id}_m_detail"></div></div>',templatehourDetails:'<div class="dijitInline" style="float:right;"><div class="dijitInline" style="margin: 0 5px;">${caption}:</div><div id="${id}_h_detail"></div></div>',templatedayDetails:'<div class="dijitInline" style="float:right;"><div class="dijitInline" style="margin: 0 5px;">${caption}:</div><div id="${id}_d_detail"></div></div>',
templateweekCB:'<div data-dojo-attach-point="${value}DayDiv" class="dijit dijitReset dijitInline dijitCheckBox" role="presentation"><input class="dijitReset dijitCheckBoxInput" data-onclick="_setWeekDetails" data-day="${value}" type="checkbox" data-dojo-attach-event="onclick:_onBoxClick, onmouseover: _onBoxMOver, onmouseout: _onBoxMOut" style="-moz-user-select: none;"></div>',templateweekDetails:'<div class="dijitInline" style="float:right;">${week_days}</div>',templatemonthDetails:'<div class="dijitInline" style="float:right;"><div class="dijitInline" style="margin: 0 5px;">${caption}:</div><div id="${id}_mo_detail"></div></div>',
templatequarterDetails:"",templateyearDetails:"",constructor:function(a){for(var b="",c=0;c<this.days.length;c++)b=b+this.templateweekCB.replace(/\$\{value\}/g,this.days[c])+this.texts[this.days[c]]+" ";this.templateweekDetails=this.templateweekDetails.replace(/\$\{week_days\}/g,b);this.templateString=this.templateStart;this.templateString+=this.templateCB.replace(/\$\{caption\}/g,this.texts.startDate).replace(/\$\{value\}/g,"sd").replace(/\$\{details\}/g,this.templateStartDate).replace(/\$\{onclick\}/g,
"_onSTSelect");this.templateString+=this.templateDivider;for(c=0;c<this.rtypes.length;c++)a["ri"+this.rtypes[c]]&&(this.rtypesVis.push(this.rtypes[c]),this.templateString+=this.templateCB.replace(/\$\{caption\}/g,this.texts[this.rtypes[c]]).replace(/\$\{value\}/g,this.rtypes[c]).replace(/\$\{details\}/g,this["template"+this.rtypes[c]+"Details"].replace(/\$\{caption\}/g,this.texts.interval)).replace(/\$\{onclick\}/g,"_onRTSelect"));this.templateString+=this.templateDivider;this.templateString+=this.templateCB.replace(/\$\{caption\}/g,
this.texts.noEndDate).replace(/\$\{value\}/g,"ned").replace(/\$\{details\}/g,"").replace(/\$\{onclick\}/g,"_onETSelect");this.templateString+=this.templateCB.replace(/\$\{caption\}/g,this.texts.endDate).replace(/\$\{value\}/g,"ed").replace(/\$\{details\}/g,this.templateEndDate).replace(/\$\{onclick\}/g,"_onETSelect");this.templateString+=this.templateCB.replace(/\$\{caption\}/g,this.texts.count).replace(/\$\{value\}/g,"count").replace(/\$\{details\}/g,this.templateCount).replace(/\$\{onclick\}/g,
"_onETSelect");this.templateString+=this.templateEnd;a.grouprequired?(this.groupRequired=eval(a.grouprequired),delete a.grouprequired):this.groupRequired=!1},startup:function(){this.inherited(arguments);this.startDate=new FIRMOS.DateTextBox({style:"float: right;",onChange:this._onSDTChange.bind(this)},this.id+"_sd");this.startTime=new dijit.form.TimeTextBox({style:"float: right;",onChange:this._onSDTChange.bind(this),constraints:{timePattern:"HH:mm",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",
visibleRange:"T01:00:00"}},this.id+"_st");this.endDate=new FIRMOS.DateTextBox({style:"float: right;",onChange:this._onEDTChange.bind(this)},this.id+"_ed");this.endTime=new dijit.form.TimeTextBox({style:"float: right;",onChange:this._onEDTChange.bind(this),constraints:{timePattern:"HH:mm",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",visibleRange:"T01:00:00"}},this.id+"_et");this.countSelect=new dijit.form.NumberSpinner({style:"float: right; width: 60px;",onChange:this._onCountChange.bind(this),
constraints:{min:1,places:0}},this.id+"_count");this.riminute&&(this.minuteCB=new dijit.form.Select({style:"width: 60px;",onChange:this._setMinuteDetails.bind(this),options:this.minuteDetails},this.id+"_m_detail"),this._setMinuteDetailsUI(""));this.rihour&&(this.hourCB=new dijit.form.Select({style:"width: 60px;",onChange:this._setHourDetails.bind(this),options:this.hourDetails},this.id+"_h_detail"),this._setHourDetailsUI(""));this.riday&&(this.dayCB=new dijit.form.Select({style:"width: 60px;",onChange:this._setDayDetails.bind(this),
options:this.dayDetails},this.id+"_d_detail"),this._setDayDetailsUI(""));this.riweek&&this._setWeekDetailsUI("");this.rimonth&&(this.monthCB=new dijit.form.Select({style:"width: 60px;",onChange:this._setMonthDetails.bind(this),options:this.monthDetails},this.id+"_mo_detail"),this._setMonthDetailsUI(""));this._selectRB(this.sdDiv);this._setValueUI(this.value||"")},_setValueUI:function(a){var b=[];""!=a&&(b=a.split("#"));for(var c=a=!0,d=0;d<b.length;d++)0==b[d].indexOf("DTSTART")?(this._setValueUIStart(b[d]),
a=!1):0==b[d].indexOf("RRULE")?(this._setValueUIRRule(b[d]),c=!1):console.error("Unknown part in recurrence rule definition: "+b[d]);a&&this._setValueUIStart("");c&&this._setValueUIRRule("")},_getChooserTime:function(a){switch(Math.round(a.getMinutes()/15)){case 0:a.setMinutes(0);break;case 1:a.setMinutes(15);break;case 2:a.setMinutes(30);break;case 3:a.setMinutes(45);break;case 4:a.setMinutes(0),a.setHours(a.getHours()+1)}return a},_setValueUIStart:function(a){""==a?(a=this._getChooserTime(new Date),
this.startDate.set("value",a),this.startTime.set("value",a)):(a=this._stringToDateTime(a.substring(8)),this.startDate.set("value",a.date),this.startTime.set("value",a.time))},_setValueUIRRule:function(a){""==a?(this._setRecurrenceTypeUI([]),this._setUntilUI(""),this._setCountUI("")):(a=a.substr(6).split(";"),1<a.length&&0==a[a.length-1].indexOf("UNTIL")?(this._setCountUI(""),this._setUntilUI(a[a.length-1]),a.pop()):(this._setUntilUI(""),1<a.length&&0==a[a.length-1].indexOf("COUNT")?(this._setCountUI(a[a.length-
1]),a.pop()):this._setCountUI("")),this._setRecurrenceTypeUI(a))},_setRecurrenceTypeUI:function(a){var b="";if(0<a.length)switch(a[0].substr(5)){case "MINUTELY":b="minute";1<a.length&&0==a[1].indexOf("INTERVAL")?this._setMinuteDetailsUI(a[1]):this._setMinuteDetailsUI("");break;case "HOURLY":b="hour";1<a.length&&0==a[1].indexOf("INTERVAL")?this._setHourDetailsUI(a[1]):this._setHourDetailsUI("");break;case "DAILY":b="day";1<a.length&&0==a[1].indexOf("INTERVAL")?this._setDayDetailsUI(a[1]):this._setDayDetailsUI("");
break;case "WEEKLY":b="week";1<a.length&&0==a[1].indexOf("BYDAY")?this._setWeekDetailsUI(a[1]):this._setWeekDetailsUI("");break;case "MONTHLY":1<a.length&&"INTERVAL=3"==a[1]?b="quarter":(b="month",1<a.length&&0==a[1].indexOf("INTERVAL")?this._setMonthDetailsUI(a[1]):this._setMonthDetailsUI(""));break;case "YEARLY":b="year"}if(""==b||!this[b+"Div"])for(a=0;a<this.rtypes.length;a++)if(this[this.rtypes[a]+"Div"]){b=this.rtypes[a];break}for(a=0;a<this.rtypesVis.length;a++)this._unselectRB(this[this.rtypesVis[a]+
"Div"]);this._selectRB(this[b+"Div"]);this._setRecurrenceType(b)},_setUntilUI:function(a){""==a?(this._selectRB(this.nedDiv),this._unselectRB(this.edDiv),this._unselectRB(this.countDiv),a=new Date,a.setFullYear(a.getFullYear()+1),a=this._getChooserTime(a),this.endDate.set("value",a),this.endTime.set("value",a),this.endDate.set("disabled",!0),this.endTime.set("disabled",!0)):(this._selectRB(this.edDiv),this._unselectRB(this.nedDiv),this._unselectRB(this.countDiv),a=this._stringToDateTime(a.substring(6)),
this.endDate.set("value",a.date),this.endTime.set("value",a.time),this.endDate.set("disabled",!1),this.endTime.set("disabled",!1));this.countSelect.set("disabled",!0)},_setCountUI:function(a){""==a?(this._selectRB(this.nedDiv),this._unselectRB(this.edDiv),this._unselectRB(this.countDiv),this.countSelect.set("value",1),this.endDate.set("disabled",!0),this.endTime.set("disabled",!0),this.countSelect.set("disabled",!0)):(this._selectRB(this.countDiv),this._unselectRB(this.nedDiv),this.countSelect.set("value",
Number(a.substring(6))),this.endDate.set("disabled",!0),this.endTime.set("disabled",!0),this.countSelect.set("disabled",!1))},_setForeverUI:function(){},_internalSetValue:function(){this.value=this._startStr;""!=this._rtypeStr&&(this.value=this.value+"#"+this._rtypeStr+this._rtypeDetailsStr+this._endStr)},_setRecurrenceType:function(a){this._disableDetails();this._rtypeDetailsStr="";if(a==this.rtypes[0])this._rtypeStr="",this._disableEndBlock(!0);else switch(this._disableEndBlock(!1),a){case this.rtypes[1]:this._disableMinuteDetails(!1);
this._setMinuteDetails();this._rtypeStr="RRULE:FREQ=MINUTELY";break;case this.rtypes[2]:this._disableHourDetails(!1);this._setHourDetails();this._rtypeStr="RRULE:FREQ=HOURLY";break;case this.rtypes[3]:this._disableDayDetails(!1);this._setDayDetails();this._rtypeStr="RRULE:FREQ=DAILY";break;case this.rtypes[4]:this._disableWeekDetails(!1);this._setWeekDetails();this._rtypeStr="RRULE:FREQ=WEEKLY";break;case this.rtypes[5]:this._disableMonthDetails(!1);this._setMonthDetails();this._rtypeStr="RRULE:FREQ=MONTHLY";
break;case this.rtypes[6]:this._rtypeStr="RRULE:FREQ=MONTHLY;INTERVAL=3";break;case this.rtypes[7]:this._rtypeStr="RRULE:FREQ=YEARLY"}this._internalSetValue()},_setMinuteDetailsUI:function(a){""==a?this.minuteCB.set("value",this.minuteDetails[0].id):(a=a.substr(9),this.minuteCB.set("value",a))},_setHourDetailsUI:function(a){""==a?this.hourCB.set("value",this.hourDetails[0].id):(a=a.substr(9),this.hourCB.set("value",a))},_setDayDetailsUI:function(a){""==a?this.dayCB.set("value",this.dayDetails[0].id):
(a=a.substr(9),this.dayCB.set("value",a))},_setWeekDetailsUI:function(a){for(var b=0;b<this.days.length;b++)this._unselectCB(this[this.days[b]+"DayDiv"]);if(""==a)b=(new Date).getDay(),0==b?b=6:b--,this._selectCB(this[this.days[b]+"DayDiv"]);else for(a=a.substr(6).split(","),b=0;b<a.length;b++)this._selectCB(this[a[b].toLowerCase()+"DayDiv"])},_setMonthDetailsUI:function(a){""==a?this.monthCB.set("value",this.monthDetails[0].id):(a=a.substr(9),this.monthCB.set("value",a))},_setMinuteDetails:function(){var a=
this.minuteCB.get("value");this._rtypeDetailsStr="1"!=a?";INTERVAL="+a:"";this._internalSetValue()},_setHourDetails:function(){var a=this.hourCB.get("value");this._rtypeDetailsStr="1"!=a?";INTERVAL="+a:"";this._internalSetValue()},_setDayDetails:function(){var a=this.dayCB.get("value");this._rtypeDetailsStr="1"!=a?";INTERVAL="+a:"";this._internalSetValue()},_setWeekDetails:function(){for(var a=[],b=0;b<this.days.length;b++)this._isSelectedCB(this[this.days[b]+"DayDiv"])&&a.push(this.days[b].toUpperCase());
this._rtypeDetailsStr=a.join(",");0<this._rtypeDetailsStr.length&&(this._rtypeDetailsStr=";BYDAY="+this._rtypeDetailsStr);this._internalSetValue()},_setMonthDetails:function(){var a=this.monthCB.get("value");this._rtypeDetailsStr="1"!=a?";INTERVAL="+a:"";this._internalSetValue()},_disableDetails:function(){this._disableMinuteDetails(!0);this._disableHourDetails(!0);this._disableDayDetails(!0);this._disableWeekDetails(!0);this._disableMonthDetails(!0)},_disableMinuteDetails:function(a){this.minuteCB.set("disabled",
a)},_disableHourDetails:function(a){this.hourCB.set("disabled",a)},_disableDayDetails:function(a){this.dayCB.set("disabled",a)},_disableWeekDetails:function(a){if(a)for(a=0;a<this.days.length;a++)this._disableCB(this[this.days[a]+"DayDiv"]);else for(a=0;a<this.days.length;a++)this._enableCB(this[this.days[a]+"DayDiv"])},_disableMonthDetails:function(a){this.monthCB.set("disabled",a)},_disableEndBlock:function(a){a?(this._disableRB(this.edDiv),this._disableRB(this.nedDiv),this.endDate.set("disabled",
!0),this.endTime.set("disabled",!0),this.countSelect.set("disabled",!0)):(this._enableRB(this.edDiv),this._enableRB(this.nedDiv),this._isSelectedRB(this.edDiv)&&(this.endDate.set("disabled",!1),this.endTime.set("disabled",!1)),this._isSelectedRB(this.countDiv)&&this.countSelect.set("disabled",!1))},_onCountChange:function(){this._endStr=";COUNT="+this.countSelect.get("value");this._internalSetValue()},_onEDTChange:function(){this._endStr=";UNTIL="+this._dateTimeToString(this.endDate.get("value"),
this.endTime.get("value"));this._internalSetValue()},_onSDTChange:function(){this._startStr="DTSTART:"+this._dateTimeToString(this.startDate.get("value"),this.startTime.get("value"));this._internalSetValue()},_stringToDateTime:function(a){var b={};a=a.split("T");b.date=new Date(Number(a[0].substr(0,4)),Number(a[0].substr(4,2))-1,Number(a[0].substr(6,2)));1<a.length&&(b.time=new Date(Number(a[0].substr(0,4)),Number(a[0].substr(4,2))-1,Number(a[0].substr(6,2)),Number(a[1].substr(0,2)),Number(a[1].substr(2,
2)),Number(a[1].substr(4,2))),7==a[1].length&&"Z"==a[6]&&b.time.setMinutes(b.time.getMinutes()+b.time.getTimezoneOffset()));return b},_dateTimeToString:function(a,b){var c=""+a.getFullYear();9>a.getMonth()&&(c+="0");c+=a.getMonth()+1;10>a.getDate()&&(c+="0");c+=a.getDate();c+="T";10>b.getHours()&&(c+="0");c+=b.getHours();10>b.getMinutes()&&(c+="0");c+=b.getMinutes();10>b.getSeconds()&&(c+="0");return c+=b.getSeconds()},_onSTSelect:function(a){},_onETSelect:function(a){switch(a.target.getAttribute("data-cbid")){case "ned":this._selectRB(this.nedDiv);
this._unselectRB(this.edDiv);this._unselectRB(this.countDiv);this._endStr="";this.endDate.set("disabled",!0);this.endTime.set("disabled",!0);this.countSelect.set("disabled",!0);break;case "ed":this._selectRB(this.edDiv);this._unselectRB(this.nedDiv);this._unselectRB(this.countDiv);this.endDate.set("disabled",!1);this.endTime.set("disabled",!1);this.countSelect.set("disabled",!0);this._endStr=";UNTIL="+this._dateTimeToString(this.endDate.get("value"),this.endTime.get("value"));break;case "count":this._selectRB(this.countDiv),
this._unselectRB(this.nedDiv),this._unselectRB(this.edDiv),this.endDate.set("disabled",!0),this.endTime.set("disabled",!0),this.countSelect.set("disabled",!1),this._endStr=";COUNT="+this.countSelect.get("value")}this._internalSetValue()},_onRTSelect:function(a){for(var b=0;b<this.rtypesVis.length;b++)this._unselectRB(this[this.rtypesVis[b]+"Div"]);this._selectRB(this[a.target.getAttribute("data-cbid")+"Div"]);this._setRecurrenceType(a.target.getAttribute("data-cbid"))},_disableRB:function(a){dojo.addClass(a.childNodes[0].childNodes[0],
"dijitDisabled");dojo.addClass(a.childNodes[0].childNodes[0],"dijitRadioDisabled");this._isSelectedRB(a)&&(dojo.addClass(a.childNodes[0].childNodes[0],"dijitCheckedDisabled"),dojo.addClass(a.childNodes[0].childNodes[0],"dijitRadioCheckedDisabled"))},_enableRB:function(a){dojo.removeClass(a.childNodes[0].childNodes[0],"dijitDisabled");dojo.removeClass(a.childNodes[0].childNodes[0],"dijitRadioDisabled");dojo.removeClass(a.childNodes[0].childNodes[0],"dijitCheckedDisabled");dojo.removeClass(a.childNodes[0].childNodes[0],
"dijitRadioCheckedDisabled")},_unselectRB:function(a){dojo.removeClass(a.childNodes[0].childNodes[0],"dijitChecked");dojo.removeClass(a.childNodes[0].childNodes[0],"dijitRadioChecked")},_selectRB:function(a){dojo.addClass(a.childNodes[0].childNodes[0],"dijitChecked");dojo.addClass(a.childNodes[0].childNodes[0],"dijitRadioChecked");dojo.hasClass(a.childNodes[0].childNodes[0],"dijitHover")&&(dojo.addClass(a.childNodes[0].childNodes[0],"dijitCheckedHover"),dojo.addClass(a.childNodes[0].childNodes[0],
"dijitRadioCheckedHover"))},_isSelectedRB:function(a){return dojo.hasClass(a.childNodes[0].childNodes[0],"dijitChecked")},_disableCB:function(a){dojo.addClass(a,"dijitDisabled");dojo.addClass(a,"dijitCheckBoxDisabled");this._isSelectedCB(a)&&(dojo.addClass(a,"dijitCheckedDisabled"),dojo.addClass(a,"dijitCheckBoxCheckedDisabled"))},_enableCB:function(a){dojo.removeClass(a,"dijitDisabled");dojo.removeClass(a,"dijitCheckBoxDisabled");dojo.removeClass(a,"dijitCheckedDisabled");dojo.removeClass(a,"dijitCheckBoxCheckedDisabled")},
_unselectCB:function(a){dojo.removeClass(a,"dijitChecked");dojo.removeClass(a,"dijitCheckBoxChecked");dojo.removeClass(a,"dijitCheckedHover");dojo.removeClass(a,"dijitCheckBoxCheckedHover")},_selectCB:function(a){dojo.addClass(a,"dijitChecked");dojo.addClass(a,"dijitCheckBoxChecked");dojo.hasClass(a,"dijitHover")&&(dojo.addClass(a,"dijitCheckedHover"),dojo.addClass(a,"dijitCheckBoxCheckedHover"))},_isSelectedCB:function(a){return dojo.hasClass(a,"dijitChecked")},_onBoxClick:function(a){dojo.hasClass(a.target.parentNode,
"dijitDisabled")||("true"==a.target.getAttribute("aria-checked")?(a.target.setAttribute("aria-checked",!1),this._unselectCB(a.target.parentNode)):(a.target.setAttribute("aria-checked",!0),this._selectCB(a.target.parentNode)),this[a.target.getAttribute("data-onclick")](a))},_onBoxMOver:function(a){dojo.hasClass(a.target.parentNode,"dijitDisabled")||(dojo.addClass(a.target.parentNode,"dijitHover"),dojo.addClass(a.target.parentNode,"dijitCheckBoxHover"),dojo.hasClass(a.target.parentNode,"dijitChecked")&&
(dojo.addClass(a.target.parentNode,"dijitCheckBoxCheckedHover"),dojo.addClass(a.target.parentNode,"dijitCheckedHover")))},_onBoxMOut:function(a){dojo.hasClass(a.target.parentNode,"dijitDisabled")||(dojo.removeClass(a.target.parentNode,"dijitHover"),dojo.removeClass(a.target.parentNode,"dijitCheckBoxHover"),dojo.removeClass(a.target.parentNode,"dijitCheckBoxCheckedHover"),dojo.removeClass(a.target.parentNode,"dijitCheckedHover"))},_onRadioClick:function(a){if(!dojo.hasClass(a.target.parentNode,"dijitDisabled"))this[a.target.getAttribute("data-onclick")](a)},
_onRadioMOver:function(a){dojo.hasClass(a.target.parentNode,"dijitDisabled")||(dojo.addClass(a.target.parentNode,"dijitHover"),dojo.addClass(a.target.parentNode,"dijitRadioHover"),dojo.hasClass(a.target.parentNode,"dijitChecked")&&(dojo.addClass(a.target.parentNode,"dijitRadioCheckedHover"),dojo.addClass(a.target.parentNode,"dijitRadioHover")))},_onRadioMOut:function(a){dojo.hasClass(a.target.parentNode,"dijitDisabled")||(dojo.removeClass(a.target.parentNode,"dijitHover"),dojo.removeClass(a.target.parentNode,
"dijitRadioHover"),dojo.removeClass(a.target.parentNode,"dijitRadioCheckedHover"),dojo.removeClass(a.target.parentNode,"dijitRadioHover"))},onChange:function(){this.inherited(arguments);for(var a=this.getParent();a&&!a.isInstanceOf(dijit.form.Form);)a=a.getParent();a&&a.isInstanceOf(FIRMOS.Form)&&(a.checkGroupRequiredFields(this),a.submitOnChange(this))}});dojo.declare("FIRMOS.FileUpload",dojox.form.Uploader,{required:!1,constructor:function(a){a.grouprequired?(this.groupRequired=eval(a.grouprequired),
delete a.grouprequired):this.groupRequired=!1;a.disabled&&(setTimeout(this.set.bind(this,"disabled",!0),0),delete a.disabled)},_isEmpty:function(){return""==this.getValue()},isValid:function(a){return!this.required||!this._isEmpty()},validate:function(a){var b="",c=this.disabled||this.isValid(a);dojo.setAttr(this.focusNode,"aria-invalid",c?"false":"true");b=this.getErrorMessage(a);this.set("message",b);return c},postMixInProperties:function(){this.inherited(arguments);this.messages=dojo.i18n.getLocalization("dijit.form",
"validate",this.lang)},getErrorMessage:function(a){return this.messages.missingMessage},_createInput:function(){this.inherited(arguments);"image"==this.usefilter&&dojo.setAttr(this.inputNode,"accept","image/*")},_onFocus:function(){this.focused=!0;this.displayMessage(this.message);this.inherited(arguments)},_onBlur:function(){this.focused=!1;this.displayMessage("");this.inherited(arguments)},displayMessage:function(a){a&&this.focused?dijit.Tooltip.show(a,this.titleNode):dijit.Tooltip.hide(this.titleNode)},
_setRequiredAttr:function(a){this._set("required",a);dojo.setAttr(this.focusNode,"aria-required",a)},_setMessageAttr:function(a){this._set("message",a);this.displayMessage(a)},onChange:function(){this.inherited(arguments);for(var a=this.getParent();a&&!a.isInstanceOf(dijit.form.Form);)a=a.getParent();a&&a.isInstanceOf(FIRMOS.Form)&&(a.checkGroupRequiredFields(this),a.submitOnChange(this))}});dojo.declare("FIRMOS.FileUpload.Image",dojox.form.uploader._Base,{uploaderId:"",uploader:null,_upCheckCnt:0,
imgheight:100,imgwidth:100,imgabs:!1,templateString:'<div class="firmosUploaderImage"></div>',constructor:function(a){this._events=[]},destroy:function(){for(;0<this._events.length;)this._events.pop().remove()},postCreate:function(){this.inherited(arguments);this.setUploader();this.value?this._createImageTag(this.value):this.contentDiv=dojo.create("div",{"class":"firmosUploaderImageContent",style:"height:"+this.imgheight+"px; width:"+this.imgwidth+"px"},this.domNode)},_createImageTag:function(a){this.contentImg=
dojo.create("img",{"class":"firmosUploaderImageContent",style:this.imgabs?"height:"+this.imgheight+"px; width:"+this.imgwidth+"px":"max-height:"+this.imgheight+"px; max-width:"+this.imgwidth+"px",src:a},this.domNode)},setUploader:function(){if(this.uploaderId||this.uploader){if(this.uploaderId&&!this.uploader&&(this.uploader=dijit.byId(this.uploaderId),!this.uploader)){this._upCheckCnt++;5<this._upCheckCnt?console.error("FIRMOS.FileUpload.Image: No FIRMOS.FileUpload found with id "+this.uploaderId):
setTimeout(this.setUploader.bind(this),250);return}this._events.push(dojo.connect(this.uploader,"onChange",this.selectionChange.bind(this)));this._events.push(dojo.connect(this.uploader,"reset",this.selectionReset.bind(this)))}else console.error("FIRMOS.FileUpload.Image: No FIRMOS.FileUpload set.")},onloadCallback:function(a){this.contentImg?dojo.setAttr(this.contentImg,"src",a.target.result):(dojo.destroy(this.contentDiv),this._createImageTag(a.target.result))},selectionChange:function(){var a=new FileReader;
a.onload=this.onloadCallback.bind(this);a.readAsDataURL(this.uploader._files[0])},selectionReset:function(){console.log("selectionReset")}});dojo.declare("FIRMOS.Form",dijit.form.Form,{constructor:function(a){this.sendChanged=dojo.fromJson(a.sendchanged);this.displayOnly=dojo.fromJson(a.displayonly);delete a.sendchanged;this.groupRequiredFields={};a.dbos&&(this.id=a.id,G_UI_COM.registerFormDBOs(this,a.dbos));a.onChangeClassname&&(this._lastChange=new Date,this._sendChangesParams={},this.sendChangesDelay=
Number(a.onChangeDelay)||0)},destroy:function(){this.dbos&&G_UI_COM.unregisterFormDBOs(this.id,this.dbos);this.inherited(arguments)},onSubmit:function(){for(var a=this.getChildren(),b=0;b<a.length;b++)if(a[b].isInstanceOf(FIRMOS.FormButton)&&"submit"==a[b].type){a[b].handleTypeSubmit();break}return!1},onShow:function(a){this.inherited(arguments);this.sendChanged&&(this.initialData=this.get("value"));for(var b=this.getChildren(),c=0;c<b.length;c++)if(b[c].name){this.displayOnly&&(b[c].isInstanceOf(FIRMOS.FormButton)||
b[c].set("disabled",!0));b[c].isInstanceOf(FIRMOS.BoolCheckBox)&&b[c].updateDepFields(b);b[c].isInstanceOf(FIRMOS.FilteringSelect)&&b[c].init();var d=b[c].name.split(".");d.pop();0==d.length?b[c].groupRequired&&(b[c].set("required",!0),d=dojo.byId(b[c].id+"_label"),dojo.removeClass(d,"firmosFormLabel"),dojo.addClass(d,"firmosFormLabelRequired")):(d=d.join("."),this.groupRequiredFields[d]||(this.groupRequiredFields[d]={},this.groupRequiredFields[d].grf=[],this.groupRequiredFields[d].required=!1,this.groupRequiredFields[d].fields=
[]),b[c].groupRequired&&this.groupRequiredFields[d].grf.push(b[c].id),this.groupRequiredFields[d].fields.push(b[c].id))}for(c in this.groupRequiredFields)if(0==this.groupRequiredFields[c].grf.length)delete this.groupRequiredFields[c];else for(b=0;b<this.groupRequiredFields[c].fields.length;b++)if(d=dijit.byId(this.groupRequiredFields[c].fields[b]),!d.isInstanceOf(FIRMOS.BoolCheckBox)&&(d=d.get("value"))&&""!=d){this._setGroupRequired(c,!0);break}},_setGroupRequired:function(a,b){for(var c=0;c<this.groupRequiredFields[a].grf.length;c++){dijit.byId(this.groupRequiredFields[a].grf[c]).set("required",
b);var d=dojo.byId(this.groupRequiredFields[a].grf[c]+"_label");b?(dojo.removeClass(d,"firmosFormLabel"),dojo.addClass(d,"firmosFormLabelRequired")):(dojo.removeClass(d,"firmosFormLabelRequired"),dojo.addClass(d,"firmosFormLabel"))}this.groupRequiredFields[a].required=b},checkGroupRequiredFields:function(a){if(!a.isInstanceOf(FIRMOS.BoolCheckBox)){var b=a.name.split(".");b.pop();if(0<b.length&&(b=b.join("."),this.groupRequiredFields[b]))if((newValue=a.get("value"))&&""!=newValue)this.groupRequiredFields[b].required||
this._setGroupRequired(b,!0);else{for(a=0;a<this.groupRequiredFields[b].fields.length;a++){var c=dijit.byId(this.groupRequiredFields[b].fields[a]);if(!c.isInstanceOf(FIRMOS.BoolCheckBox)&&(c=c.get("value"))&&""!=c)return}this._setGroupRequired(b,!1)}}},submitOnChange:function(a){if(this.onChangeClassname&&(!a||!a.get("disabled"))){var b=new Date;a&&(this._lastChange=b,this._sendChangesParams[a.name]=a.get("value"));a=b-this._lastChange;a>this.sendChangesDelay?(dojo.clone(this.onChangeParams),G_SERVER_COM.callServerFunction(this.onChangeClassname,
this.onChangeFunctionname,this.onChangeUidPath,this._sendChangesParams),this._sendChangesParams={}):(this._sendTimeout&&clearTimeout(this._sendTimeout),this._sendTimeout=setTimeout(this.submitOnChange.bind(this),this.sendChangesDelay-a))}},_clearObject:function(a,b){for(var c in a)if(a[c]instanceof Array){if(a[c].length==b[c].length){for(var d=!0,e=0;e<a[c].length;e++)if(a[c][e]!=b[c][e]){d=!1;break}d&&delete a[c]}}else if(a[c]instanceof Date||b[c]instanceof Date)a[c]instanceof Date&&b[c]instanceof
Date&&a[c].getTime()==b[c].getTime()&&delete a[c];else if("object"==typeof a[c]){this._clearObject(a[c],b[c]);d=!0;for(e in a[c]){d=!1;break}d&&delete a[c]}else a[c]==b[c]&&delete a[c]},_convertObjectData:function(a){for(var b in a)if(a[b]instanceof Array)for(var c=0;c<a[b].length;c++)a[b][c]instanceof Date&&(a[b][c]=a[b][c].getTime());else a[b]instanceof Date?a[b]=a[b].getTime():"object"==typeof a[b]&&this._convertObjectData(a[b])},_getValueAttr:function(){for(var a=this.inherited(arguments),b=this.getChildren(),
c=0;c<b.length;c++)b[c].name&&b[c]._ignore&&a[b[c].name]&&delete a[b[c].name];return a},_handleFiles:function(a,b,c,d,e,f){for(var g=this.getChildren(),h=[],k=0;k<g.length;k++)if(g[k].name&&g[k].isInstanceOf(FIRMOS.FileUpload)&&g[k]._files)for(var l=0;l<g[k]._files.length;l++)h.push({field:g[k].name,file:g[k]._files[l]});0<h.length?this._sendFiles(a,b,c,d,e,f,h):this._sendData(a,b,c,d,e,f)},_sendFilesCallback:function(a,b,c,d,e,f,g){0==g.length?this._sendData(a,b,c,d,e,f):this._sendFiles(a,b,c,d,
e,f,g)},_sendFiles:function(a,b,c,d,e,f,g){var h=g.pop(),k=h.file,l={data:{}};l.data.size=k.size;l.data.name=k.name;l.data.type=k.type;l.data.field=h.field;l.data.fieldIdx=0;l.data.chunksize=k.size;l.data.chunkIdx=0;a=this._sendFilesCallback.bind(this,a,b,c,d,e,f,g);G_SERVER_COM.callServerFunction("FIRMOS","binaryBulkTransfer",null,l,a,null,k)},_sendData:function(a,b,c,d,e,f){d.data=this.get("value");this.submitData=dojo.clone(d.data);this.sendChanged&&this._clearObject(d.data,this.initialData);this._convertObjectData(d.data);
dojo.mixin(d.data,e);f&&G_UI_COM.isDialogAction();G_SERVER_COM.callServerFunction(a,b,c,d,this.submitCallback.bind(this))},callServerFunction:function(a,b,c,d,e,f){if(!this.validate())return this.restoreAllButtons(),!1;this._handleFiles(a,b,c,d,e,f)},submitCallback:function(a,b,c,d){this.restoreAllButtons();G_SERVER_COM.handleServerFunctionResponse(a,b,c,d)},disableAllButtons:function(){for(var a=this.getChildren(),b=0;b<a.length;b++)a[b].isInstanceOf(FIRMOS.FormButton)&&(a[b]._orgState=a[b].get("disabled"),
a[b].set("disabled",!0))},restoreAllButtons:function(){for(var a=this.getChildren(),b=0;b<a.length;b++)a[b].isInstanceOf(FIRMOS.FormButton)&&(a[b].set("disabled",a[b]._orgState),delete a[b]._orgState)},_updateValues:function(a,b){for(var c in a)if("uid"!=c)if(c instanceof Object)if(c instanceof Array){var d=this._getInputById(b+c);d&&d.set("value",a[c])}else this._updateValues(a[c],b+c+".");else(d=this._getInputById(b+c))&&(d.isInstanceOf(FIRMOS.DateTextBox)?d.set("displayedValue",a[c]):d.set("value",
a[c]))},updateValues:function(a){this._updateValues(a,"")},_getInputById:function(a){for(var b=this.getChildren(),c=0;c<b.length;c++)if(b[c].name==a)return b[c];return null}});dojo.declare("FIRMOS.ToolbarButton",dijit.form.Button,{onClick:function(){this.downloadId&&dojo.io.iframe.setSrc(dojo.byId("FirmOSDownload"),this.downloadId,!0);this.actionClassname&&G_SERVER_COM.callServerFunction(this.actionClassname,this.actionFunctionname,this.actionUidPath,this.actionParams)}});dojo.declare("FIRMOS.Toolbar",
dijit.Toolbar,{constructor:function(a){},postCreate:function(){this.inherited(arguments);for(var a=0;a<this.menuDef.length;a++){if(this.menuDef[a].menu){var b={style:"display: none;"};this.menuDef[a].id&&(b.id=this.menuDef[a].id);var b=new dijit.DropDownMenu(b),c=G_UI_COM.addMenuEntries(b,this.menuDef[a].menu,this.menuDef[a].disabled);b.set("disabled",c);c={label:this.menuDef[a].caption,dropDown:b,disabled:c};c=new dijit.form.DropDownButton(c);b._parentUIElement=c}else{b=this.menuDef[a];c={};b.action&&
(c.actionClassname=b.action["class"],c.actionFunctionname=b.action.func,c.actionUidPath=b.action.uidPath,c.actionParams=b.action.params);b.downloadId&&(c.downloadId=b.downloadId);""==b.caption?c.showLabel=!1:c.label=b.caption;if(b.icon){var d=b.icon.replace(/[\/\.]/g,"");G_UI_COM.createCSSRule(d,"background-image: url('"+b.icon+"');background-repeat: no-repeat; height: 18px;text-align: center;width: 18px;");c.iconClass=d}b.disabled&&(c.disabled=!0);b.id&&(c.id=b.id);c=new FIRMOS.ToolbarButton(c)}this.addChild(c)}}});
dojo.declare("FIRMOS.Menu",dijit.Menu,{_clearEntries:function(){for(var a=this.getChildren(),b=0;b<a.length;b++)this.removeChild(a[b]),a[b].destroyRecursive()},setCoords:function(a,b){this._openMyselfArgs||(this._openMyselfArgs={});this._openMyselfArgs.coords={x:a,y:b}},entriesLoaded:function(a){this._clearEntries();G_UI_COM.addMenuEntries(this,a,!1);this.startup();this._openMyself(this._openMyselfArgs,!0)},_openMyself:function(a,b){if(b)this.inherited(arguments,[a]);else switch(this.cType){case "tree":this._openMyselfArgs=
a;this._handleTreeMenu(a);break;default:0<this.getChildren().length&&this.inherited(arguments)}},_handleTreeMenu:function(a){var b=dijit.getEnclosingWidget(a.target);a={};var c,d;if(b.isInstanceOf(dijit._TreeNode)){var e=b.item,f=b.tree;dojo.mixin(a,f.model.store.params_);b=e.uidpath?e.uidpath instanceof Array?e.uidpath:[e.uidpath]:[e.uid];e._menufunc_&&e._funcclassname_?(c=e._funcclassname_,d=e._menufunc_):this.treeItemClassname&&(c=this.treeItemClassname,d=this.treeItemFunctionname,dojo.mixin(a,
this.treeItemParams),this.treeItemUIDPath&&(b=this.treeItemUIDPath));if(0<b.length||f.model.store.getIdentity(e)!=b[0])a.selected=[f.model.store.getIdentity(e)]}else f=b,dojo.mixin(a,f.model.store.params_),c=this.treeClassname,d=this.treeFunctionname,b=this.treeUidPath,dojo.mixin(a,this.treeParams);if(c){for(;f&&!f.isInstanceOf(dijit.Tree);)f=f.getParent();G_UI_COM.setMenu(this);G_SERVER_COM.callServerFunction(c,d,b,a)}},_handleGridMenu:function(a,b,c){this._openMyselfArgs={target:a.target,coords:{x:a.pageX,
y:a.pageY}};a=dojo.clone(b.store.params_);var d={};d.uidPath=c.uidpath?c.uidpath instanceof Array?c.uidpath:[c.uidpath]:[c.uid];c._menufunc_&&c._funcclassname_?(d.classname=c._funcclassname_,d.functionname=c._menufunc_):this.gridClassname&&(d.classname=this.gridClassname,d.functionname=this.gridFunctionname,dojo.mixin(a,this.gridParams),this.gridUIDPath&&(d.uidPath=this.gridUIDPath));if(d&&d.classname){b=b.getSelectedIds();if(1<b.length||0<d.uidPath.length||b[0]!=d.uidPath[0])a.selected=b;G_UI_COM.setMenu(this);
G_SERVER_COM.callServerFunction(d.classname,d.functionname,d.uidPath,a)}}});dojo.declare("FIRMOS.FilteringSelect",dijit.form.FilteringSelect,{_hidden:!1,constructor:function(a){a.grouprequired?(this.groupRequired=eval(a.grouprequired),delete a.grouprequired):this.groupRequired=!1;a.depGroup?(this.depGroup=dojo.fromJson(a.depGroup),delete a.depGroup):this.depGroup=[]},_updateDepField:function(a,b){var c=dojo.byId(a.inputId+"_tr");if(c){dijit.byId(a.inputId);for(var d=c.querySelectorAll("[widgetid]"),
e=[],f=0;f<d.length;f++)e[f]=dijit.byId(d[f].getAttribute("widgetid"));if(b||a.value!=this.value)for(dojo.style(c,"display","none"),f=0;f<e.length;f++)a.ignoreHidden&&(e[f]._ignore=!0,e[f].get("required")&&(e[f]._required=!0,e[f].set("required",!1))),e[f].isInstanceOf(FIRMOS.FilteringSelect)&&e[f].hide();else for(dojo.style(c,"display",""),f=0;f<e.length;f++)delete e[f]._ignore,e[f]._required&&(e[f].set("required",e[f]._required),delete e[f]._required),e[f].isInstanceOf(FIRMOS.FilteringSelect)&&e[f].unhide()}},
hide:function(){this._hidden=!0;this._hideAllDepFields()},unhide:function(){this._hidden=!1;this._updateDepGroup()},_updateDepGroup:function(){for(var a=0;a<this.depGroup.length;a++)this._updateDepField(this.depGroup[a])},_hideAllDepFields:function(){for(var a=0;a<this.depGroup.length;a++)this._updateDepField(this.depGroup[a],!0)},init:function(){""==this.value&&(this.required||this._required)&&0<this.store.data.length&&this.set("value",this.store.data[0].value);this._hidden?this._hideAllDepFields():
this._updateDepGroup()},onChange:function(a){this.inherited(arguments);this._hidden||this._updateDepGroup();for(var b=this.getParent();b&&!b.isInstanceOf(dijit.form.Form);)b=b.getParent();b&&b.isInstanceOf(FIRMOS.Form)&&(b.checkGroupRequiredFields(this),b.submitOnChange(this))}});dojo.declare("FIRMOS.BoolCheckBox",dijit.form.CheckBox,{constructor:function(a){a.dependentfields?(this.depFields=dojo.fromJson(a.dependentfields),this.hasDepFields=!0,delete a.dependentfields):(this.hasDepFields=!1,this.depFields=
{});a.grouprequired?(this.groupRequired=eval(a.grouprequired),delete a.grouprequired):this.groupRequired=!1},updateDepFields:function(a){for(var b in this.depFields)for(var c=0;c<a.length;c++)if(b==a[c].name){"true"==this.get("value")&&this.depFields[b]||"false"==this.get("value")&&!this.depFields[b]?a[c].set("disabled",!0):a[c].set("disabled",!1);break}},onChange:function(){this.inherited(arguments);if(this.hasDepFields){for(var a=this.getParent();a&&!a.isInstanceOf(dijit.form.Form);)a=a.getParent();
this.updateDepFields(a.getChildren())}},_getValueAttr:function(){return this.checked?"true":"false"}});dojo.declare("FIRMOS.MultiValText",dijit.form.Textarea,{constructor:function(a){a.grouprequired?(this.groupRequired=eval(a.grouprequired),delete a.grouprequired):this.groupRequired=!1},_getValueAttr:function(){var a=this.inherited(arguments);return""==a?[]:a.split("\n")},filter:function(a){var b="object"==typeof a?this.inherited(arguments,[a.join("\n")]):this.inherited(arguments),b=b.replace(/\n+/g,
"\n");b.lastIndexOf("\n")==b.length-1&&(b=b.substring(0,b.length-1));return b},_setBlurValue:function(){},onChange:function(){this.inherited(arguments);for(var a=this.getParent();a&&!a.isInstanceOf(dijit.form.Form);)a=a.getParent();a&&a.isInstanceOf(FIRMOS.Form)&&(a.checkGroupRequiredFields(this),a.submitOnChange(this))}});dojo.declare("FIRMOS.ValidationTextBox",dijit.form.ValidationTextBox,{constructor:function(a){a.forbiddenchars?(this.regExpForbidden=eval(a.forbiddenchars),delete a.forbiddenchars):
this.regExpForbidden=null;a.grouprequired?(this.groupRequired=eval(a.grouprequired),delete a.grouprequired):this.groupRequired=!1},isValid:function(a){if(this.confirms){var b=this.getParent()._getInputById(this.confirms);if(this.get("value")!=b.get("value"))return!1}return this.inherited(arguments)},validate:function(a){if(this.regExpForbidden){var b=this.textbox.selectionStart,c=this.textbox.value.length,d=this.textbox.value.replace(this.regExpForbidden,"");d.length<c&&(this.textbox.value=d,c-=d.length,
this.textbox.selectionStart=b-c,this.textbox.selectionEnd=b-c)}return this.inherited(arguments)},onChange:function(){this.inherited(arguments);for(var a=this.getParent();a&&!a.isInstanceOf(dijit.form.Form);)a=a.getParent();a&&a.isInstanceOf(FIRMOS.Form)&&(a.checkGroupRequiredFields(this),a.submitOnChange(this))}});dojo.declare("FIRMOS.NumberTextBox",dijit.form.NumberTextBox,{constructor:function(a){a.constraints||(a.constraints={});this.regExpForbidden=a.constraints.places&&0==a.constraints.places?
/[^\d\-]/g:/[^\d\.\,\-]/g;a.grouprequired?(this.groupRequired=eval(a.grouprequired),delete a.grouprequired):this.groupRequired=!1},_setBlurValue:function(){},validate:function(a){var b=this.textbox.selectionStart,c=this.textbox.value.length,d=this.textbox.value.replace(this.regExpForbidden,"");d.length<c&&(this.textbox.value=d,c-=d.length,this.textbox.selectionStart=b-c,this.textbox.selectionEnd=b-c);return this.inherited(arguments)},_getValueAttr:function(){var a=this.inherited(arguments);isNaN(a)&&
(a="");return a},onChange:function(){this.inherited(arguments);for(var a=this.getParent();a&&!a.isInstanceOf(dijit.form.Form);)a=a.getParent();a&&a.isInstanceOf(FIRMOS.Form)&&(a.checkGroupRequiredFields(this),a.submitOnChange(this))}});dojo.declare("FIRMOS.NumberSlider",dijit.form._FormValueWidget,{templateString:'<div data-dojo-attach-point="focusNode" id="${id}" role="presentation"><div id="${id}_number"></div><div id="${id}_slider"></div></div>',constructor:function(a){a.constraints=dojo.fromJson(a.constraints);
this.sliderParams={};this.sliderParams.minimum=a.constraints.min;this.sliderParams.maximum=a.constraints.max;a.constraints.steps&&(this.sliderParams.discreteValues=a.constraints.steps);this.sliderParams.value=a.value;this.sliderParams.intermediateChanges=a.intermediateChanges;a.showvalue&&(this.showvalue=eval(a.showvalue),delete a.showvalue);this.showvalue&&(this.sliderParams.style="width:75%;",this.numberParams={},this.numberParams.style="width:20%; float:right;",this.numberParams.value=a.value,
this.numberParams.places=a.constraints.places,this.numberParams.disabled=!0);this._multi=1;for(var b=0;b<a.constraints.places;b++)this._multi*=10},startup:function(){this.inherited(arguments);this.sliderParams.onChange=this._onSliderChange.bind(this);this.showvalue&&(this.number=new dijit.form.NumberTextBox(this.numberParams,this.id+"_number"));this.slider=new dijit.form.HorizontalSlider(this.sliderParams,this.id+"_slider")},_onSliderChange:function(){if(Math.round(this.slider.get("value")*this._multi)/
this._multi!=this.value){this.value=Math.round(this.slider.get("value")*this._multi)/this._multi;this.showvalue&&this.number.set("value",this.value);var a=this.getParent();a&&a.isInstanceOf(FIRMOS.Form)&&a.submitOnChange(this)}}});dojo.declare("FIRMOS.TabContainer",dijit.layout.TabContainer,{constructor:function(){this.watch("selectedChildWidget",this.tabChange)},addTabs:function(a){a.sort(G_UI_COM.sortFuncSubSecOrd);for(var b=0;b<a.length;b++)this.addChild(a[b]),G_UI_COM.showSectionPathInProgress||
!a[b].selected||a[b]._fixContent||this.tabChange("",null,a[b])},contentLoadedCallback:function(a,b,c,d,e){G_SERVER_COM.handleServerFunctionResponse(b,c,d,e);a._loadedCallback&&(a._loadedCallback(),delete a._loadedCallback)},selectChild:function(a,b){b&&(a._fixContent?b():a._loadedCallback=b);!a._fixContent&&a.selected&&this.tabChange("",null,a);this.inherited(arguments)},selectDefault:function(){for(var a=this.getChildren(),b=0;b<a.length;b++)if(a[b].selected){this.selectChild(a[b]);break}},tabChange:function(a,
b,c){if(c._fixContent){var d=[];this._getDescendants(c,d,"visibilityChange");for(a=0;a<d.length;a++)d[a].visibilityChange(!0)}else G_SERVER_COM.callServerFunction(c._contentFunc["class"],c._contentFunc.func,c._contentFunc.uidPath,c._contentFuncParams,this.contentLoadedCallback.bind(this,c),c._updateId);this.UIStateChangeClass&&(a=this.UIStateChangeParams,a.sectionId=c.id,G_SERVER_COM.callServerFunction(this.UIStateChangeClass,this.UIStateChangeFunc,this.UIStateChangeUidPath,a));if(b)if(b._fixContent)for(c=
[],this._getDescendants(b,c,"visibilityChange"),a=0;a<c.length;a++)c[a].visibilityChange(!1);else{c=[];this._getDescendants(b,c,"destroyNotify");if(0<c.length){d=[];for(a=0;a<c.length;a++)d.push(c[a].id);G_SERVER_COM.callServerFunction("FIRMOS","destroy",null,{ids:d})}c=null;if(b.isTCElem)for(b=b.getChildren(),a=0;a<b.length;a++){if(!b[a].isInstanceOf(FIRMOS.Toolbar)){b=b[a].getChildren();0<b.length&&(c=b[0]);break}}else c=b.getChildren()[0];c&&c.destroyRecursive()}},_getDescendants:function(a,b,
c){a[c]&&b.push(a);for(var d=a.getChildren(),e=0;e<d.length;e++)a.isInstanceOf(FIRMOS.TabContainer)&&!d[e].selected||this._getDescendants(d[e],b,c)},getChild:function(a){for(var b=this.getChildren(),c=0;c<b.length;c++)if(b[c].id==a)return b[c];return null}});dojo.declare("FIRMOS.MultiContentTabController",null,{constructor:function(){this.domNode=dojo.create("div")},startup:function(){},destroy:function(){dojo.destroy(this.domNode)}});dojo.declare("FIRMOS.MultiContentContainer",FIRMOS.TabContainer,
{baseClass:"firmosMultiContentContainer",constructor:function(a){this.animationSpeed=20;this.animationStep=0.1;this.controllerWidget=FIRMOS.MultiContentTabController},addTabs:function(a){this.inherited(arguments);for(var b=0;b<a.length;b++)a[b].domNode.style.position="absolute"},_animateHideChild:function(a,b){0>b?(a.domNode.style.opacity=0,this.hideChildTO=null,this._hideChild(a,!0)):(a.domNode.style.opacity=b,this.hideChildTO=setTimeout(this._animateHideChild.bind(this,a,b-this.animationStep),this.animationSpeed))},
_hideChild:function(a,b){this.hideChildTO?(clearTimeout(this.hideChildTO),this.hideChildTO=null,this.inherited(this.hideArgs),this.hideArgs=arguments):this.hideArgs||(this.hideArgs=arguments);b?(this.inherited(this.hideArgs),this.hideArgs=null):this._animateHideChild(a,1)},_animateShowChild:function(a,b){1<b?(this.showChildTO=null,a.domNode.style.opacity=1):(a.domNode.style.opacity=b,this.showChildTO=setTimeout(this._animateShowChild.bind(this,a,b+this.animationStep),this.animationSpeed))},_showChild:function(a){this.showChildTO&&
(clearTimeout(this.showChildTO),this.showChildTO=null);this.inherited(arguments);a.domNode.style.opacity=0;this._animateShowChild(a,0)}});dojo.declare("FIRMOS.SplitContainer",dijit.layout.BorderContainer,{addChildren:function(a){var b;if(2<a.length){b=a.shift();b.region="top";var c=100-b._height;b.set("style","height: "+b._height+"%;");this.addChild(b);b=a.pop();b.region="bottom";c-=b._height;b.set("style","height: "+b._height+"%;");this.addChild(b);b=new FIRMOS.SplitContainer({id:this.id+"_child",
"class":"borderContainer",region:"center",gutters:!1});b.set("style","height: "+c+"%;");for(var d=0;d<a.length;d++)a[d]._height=a[d]._height/c*100;this.addChild(b);b.addChildren(a)}else 2==a.length&&(b=a.shift(),b.region="top",b.set("style","height: "+b._height+"%;"),this.addChild(b)),b=a.pop(),b.region="center",b.set("style","height: "+b._height+"%;"),this.addChild(b)}});dojo.declare("FIRMOS.GridFilter",null,{texts:G_TEXTS.gridfilter,renderHeader:function(){this.inherited(arguments);if(!this.filterDisabled)for(var a=
dojo.query(".dgrid-cell",this.headerNode),b=0;b<a.length;b++){var c=a[b].columnId;if(this.columns[c]&&this.columns[c].filterable&&this.columns[c].dataType&&"ICO"!=this.columns[c].dataType){var d=dijit.byId(this.id+"_"+c+"_ddb");if(!d){switch(this.columns[c].dataType){case "STR":var e=this.getStringFilterDialog(this.columns[c]),f="setStringFilter";break;case "DAT":e=this.getDateFilterDialog(this.columns[c]);f="setDateFilter";break;case "NUM":case "PRG":e=this.getNumberFilterDialog(this.columns[c]);
f="setNumberFilter";break;case "BOO":e=this.getBooleanFilterDialog(this.columns[c]);f="setBooleanFilter";break;default:console.error('Grid filter error: Unknown data type set for column "'+this.columns[c].label.replace(/"/g,'"')+'": '+this.columns[c].dataType)}var e='<form dojoType="dijit.form.Form" id="'+this.id+"_"+c+'" onsubmit="return false;"><table style="width:100%">'+e+'<tr><td colspan="2" class="firmosGridFilterDialogButtons"><button data-dojo-type="dijit.form.Button" type="button" onClick="var ttd=this.getParent().getParent(); ttd.formValues=ttd.getChildren()[0].get(\'value\'); ttd.grid.'+
f+"('"+c+"',ttd.formValues); ttd.ddbutton.closeDropDown();\">"+this.texts.setButton+'</button><button data-dojo-type="dijit.form.Button" type="button" onClick="var ttd=this.getParent().getParent(); ttd.formValues=ttd.getChildren()[0].reset(); ttd.formValues=ttd.getChildren()[0].get(\'value\'); ttd.grid.clearFilter(\''+c+"'); ttd.ddbutton.closeDropDown();\">"+this.texts.clearButton+"</button></td></tr></table></form>",g=new dijit.TooltipDialog({id:this.id+"_"+c+"_td","class":"firmosGridFilterDialog"+
this.columns[c].dataType,content:e,onShow:function(a){this.formValues=this.getChildren()[0].get("value")},onOpen:function(a){this.getChildren()[0].set("value",this.formValues)},grid:this}),d=new dijit.form.DropDownButton({id:this.id+"_"+c+"_ddb",label:"",dropDown:g,"class":"firmosGridFilter",iconClass:"firmosGridFilterIconClass",onClick:function(a){a.preventDefault();dojo.stopEvent(a);return!1}});g.ddbutton=d}a[b].appendChild(d.domNode)}}},clearFilter:function(a){G_UI_COM.deleteStoreDependency(this.store.id,
a);a=dojo.query(".firmosGridFilter",this.column(a).headerNode);dojo.removeClass(a[0],"firmosGridFilterSet");this.refresh()},setStringFilter:function(a,b){""==b.filter?this.clearFilter(a):(G_UI_COM.setStoreDependency(this.store.id,a,"SS",[b.filter]),this.filterSet(a))},setNumberFilter:function(a,b){if(b.type==this.texts.numberOptions.gtlt){if(""==b.value1&&""==b.value2){this.clearFilter(a);return}}else if(""==b.value){this.clearFilter(a);return}switch(b.type){case this.texts.numberOptions.eq:G_UI_COM.setStoreDependency(this.store.id,
a,"R8",[b.value],"EX");break;case this.texts.numberOptions.lt:G_UI_COM.setStoreDependency(this.store.id,a,"R8",[b.value],"LE");break;case this.texts.numberOptions.gt:G_UI_COM.setStoreDependency(this.store.id,a,"R8",[b.value],"GT");break;case this.texts.numberOptions.gtlt:G_UI_COM.setStoreDependency(this.store.id,a,"R8",[b.value1,b.value2],"REXB")}this.filterSet(a)},setDateFilter:function(a,b){if(b.type==this.texts.dateOptions.gtlt){if(!b.value1&&!b.value2){this.clearFilter(a);return}}else if(!b.value){this.clearFilter(a);
return}switch(b.type){case this.texts.dateOptions.eq:G_UI_COM.setStoreDependency(this.store.id,a,"DT",[b.value],"EX");break;case this.texts.dateOptions.lt:G_UI_COM.setStoreDependency(this.store.id,a,"DT",[b.value],"LE");break;case this.texts.dateOptions.gt:G_UI_COM.setStoreDependency(this.store.id,a,"DT",[b.value],"GT");break;case this.texts.dateOptions.gtlt:G_UI_COM.setStoreDependency(this.store.id,a,"DT",[b.value1,b.value2],"REXB")}this.filterSet(a)},setIconFilter:function(a,b){this.filterSet(a)},
setBooleanFilter:function(a,b){G_UI_COM.setStoreDependency(this.store.id,a,"BO",[b.filter]);this.filterSet(a)},filterSet:function(a){a=dojo.query(".firmosGridFilter",this.column(a).headerNode);dojo.addClass(a[0],"firmosGridFilterSet");this.refresh()},getStringFilterDialog:function(a){return'<tr><td class="firmosGridFilterFormLabelTD"><label for="'+this.id+"_"+a.id+'_filter">'+this.texts.filterLabel+'</label></td><td class="firmosGridFilterFormInputTD"><input data-dojo-type="dijit.form.TextBox" id="'+
this.id+"_"+a.id+'_filter" name="filter" style="width:100%"></td></tr>'},numberFilterTypeChange:function(a,b,c){c=dijit.byId(b+"_value");var d=dijit.byId(b+"_value1");b=dijit.byId(b+"_value2");a==this.texts.numberOptions.gtlt?(dojo.style(c.domNode,"display","none"),dojo.style(d.domNode,"display",""),dojo.style(b.domNode,"display","")):(dojo.style(c.domNode,"display",""),dojo.style(d.domNode,"display","none"),dojo.style(b.domNode,"display","none"))},dateFilterTypeChange:function(a,b,c){c=dijit.byId(b+
"_value");var d=dijit.byId(b+"_value1");b=dijit.byId(b+"_value2");a==this.texts.dateOptions.gtlt?(dojo.style(c.domNode,"display","none"),dojo.style(d.domNode,"display",""),dojo.style(b.domNode,"display","")):(dojo.style(c.domNode,"display",""),dojo.style(d.domNode,"display","none"),dojo.style(b.domNode,"display","none"))},getNumberFilterDialog:function(a){return'<tr><td class="firmosGridFilterFormLabelTD"><select id="'+this.id+"_"+a.id+'_type" data-dojo-type="dijit.form.ComboBox" style="width:100%" name="type" data-dojo-props="onChange:function(value) {var ttd=this.getParent().getParent(); ttd.grid.numberFilterTypeChange(value,\''+
this.id+"_"+a.id+"',this);}\"><option>"+this.texts.numberOptions.eq+"</option><option>"+this.texts.numberOptions.lt+"</option><option>"+this.texts.numberOptions.gt+"</option><option>"+this.texts.numberOptions.gtlt+'</option></select></td><td class="firmosGridFilterFormInputTD"><input data-dojo-type="FIRMOS.NumberTextBox" id="'+this.id+"_"+a.id+'_value" name="value" style="width:100%"><input data-dojo-type="FIRMOS.NumberTextBox" id="'+this.id+"_"+a.id+'_value1" name="value1" style="display: none; width:45%; float: left;"><input data-dojo-type="FIRMOS.NumberTextBox" id="'+
this.id+"_"+a.id+'_value2" name="value2" style="display: none; width:45%; float: right;"></td></tr>'},getDateFilterDialog:function(a){return'<tr><td class="firmosGridFilterFormLabelTD"><select id="'+this.id+"_"+a.id+'_type" data-dojo-type="dijit.form.ComboBox" style="width:100%" name="type" data-dojo-props="onChange:function(value) {var ttd=this.getParent().getParent(); ttd.grid.dateFilterTypeChange(value,\''+this.id+"_"+a.id+"',this);}\"><option>"+this.texts.dateOptions.eq+"</option><option>"+this.texts.dateOptions.lt+
"</option><option>"+this.texts.dateOptions.gt+"</option><option>"+this.texts.dateOptions.gtlt+'</option></select></td><td class="firmosGridFilterFormInputTD"><input data-dojo-type="FIRMOS.DateTextBox" id="'+this.id+"_"+a.id+'_value" name="value" style="width:100%"><input data-dojo-type="FIRMOS.DateTextBox" id="'+this.id+"_"+a.id+'_value1" name="value1" style="display: none; width:45%; float: left;"><input data-dojo-type="FIRMOS.DateTextBox" id="'+this.id+"_"+a.id+'_value2" name="value2" style="display: none; width:45%; float: right;"></td></tr>'},
getIconFilterDialog:function(a){return""},getBooleanFilterDialog:function(a){return'<tr><td class="firmosGridFilterFormLabelTD"><label for="'+this.id+"_"+a.id+'_filter">'+this.texts.filterLabel+'</label></td><td class="firmosGridFilterFormInputTD"><select data-dojo-type="dojox.form.CheckedMultiSelect" style="width:100%" id="'+this.id+"_"+a.id+'_filter" name="filter" value="true"><option value="true">Yes</option><option value="false">No</option></select></td></tr>'}});dojo.declare("FIRMOS.StoreSeries",
null,{constructor:function(a,b,c,d){this.chartId=d;this.store=a;this.kwArgs=b;this.value=c?"function"==typeof c?c:"object"==typeof c?function(a){var b={},d;for(d in c)b[d]=a[c[d]];return b}:function(a){return a[c]}:function(a){return a.value};this.data=[];this._initialRendering=!1;this.fetch()},destroy:function(){this.observeHandle&&this.observeHandle.remove()},setSeriesObject:function(a){this.series=a},fetch:function(){function a(){b.data=dojo.array.map(b.objects,function(a){return b.value(a,b.store)});
b._pushDataChanges()}this.objects=[];var b=this;this.observeHandle&&this.observeHandle.remove();var c=this.store.query(this.kwArgs.query,this.kwArgs);dojo.Deferred.when(c,function(c){b.objects=c;a()});c.observe&&(this.observeHandle=c.observe(a,!0,this.chartId))},_pushDataChanges:function(){this.series&&(this.series.chart.updateSeries(this.series.name,this,this._initialRendering),this._initialRendering=!1,this.series.chart.delayedRender())}});dojo.declare("FIRMOS.D3Chart",dijit.layout.ContentPane,
{constructor:function(a){for(var b in a)this[b]=a[b];if(!this.seriesColor)for(this.seriesColor=[],b=0;b<this.seriesCount;b++)this.seriesColor[b]="000";G_UI_COM.createCSSRule("d3axis path, .axis line","fill: none;shape-rendering: crispedges;stroke: #000000;");this._events=[];this.scale_y=this.scale_x=this.chartCaption=this.clipPathRect=this.clipPath=this.svgMainG=this.svg=this.container=null;this.margin={top:20,right:20,bottom:20,left:40};this.axisYG=this.axisY=null;this.stopped=!0;this.axisXG=this.axisX=
null;this.axisXMargin=0;this.legend=this.axisYG=this.axisY=null;this.legendItems=[];this.legendSize=0;this.newLines=[];switch(a.type){case "lct_line":this.dataIdx=0;this.buffer=[];this._animationTime=this.updateInterval;this._animationStart_1=new Date;this._animationStart_2=new Date;this._oldAnimationTime_2=this._oldAnimationTime_1=this.updateInterval;this._dataToLate=this._doNotCalc=0;break;case "lct_column":this.data=[],this.rects=[]}this.dummyData=this.dataMin-this.dataMax;this.domainX=[];if("lct_line"==
a.type||"lct_sampledline"==a.type)this.interpolation="linear",this.path=[],this.line=[],this.data=[];G_UI_COM.registerLiveChart(this)},visibilityChange:function(a){a?this.start():this.stop()},destroy:function(){this.stop();G_UI_COM.unregisterLiveChart(this);for(this._removeSeriesCSS();0<this._events.length;)this._events.pop().remove();this.inherited(arguments)},redefine:function(a){var b=!1;a.caption&&this.caption!=a.caption&&(this.caption=a.caption,this.chartCaption.text(this.caption));a.dataLabels&&
(this.dataLabels=a.dataLabels);if(a.dataCount&&this.dataCount!=a.dataCount){switch(this.type){case "lct_line":this.domainX=[1,a.dataCount-2];for(var c=0;c<this.seriesCount;c++)if(a.dataCount>this.dataCount)for(var d=0;d<a.dataCount-this.dataCount;d++)this.data[c].unshift(this.dummyData);else for(d=0;d<this.dataCount-a.dataCount;d++)this.data[c].shift();break;case "lct_sampledline":this.domainX=[0,a.dataCount-1];break;case "lct_column":this.domainX=this.dataLabels?d3.range(a.dataCount).map(function(a){return this.dataLabels[a]}.bind(this)):
d3.range(a.dataCount).map(function(a){return a})}this.dataCount=a.dataCount;this.scale_x.domain(this.domainX)}if(a.dataLabels||a.dataCount&&this.dataCount!=a.dataCount)this.axisXG.call(this.axisX).selectAll("text").style("text-anchor","end"),this._adjustAxisX(),b=!0;(a.seriesColor||a.seriesCount&&this.seriesCount!=a.seriesCount)&&this._removeSeriesCSS();a.seriesColor&&(this.seriesColor=a.seriesColor);if(a.seriesCount&&this.seriesCount!=a.seriesCount){if(a.seriesCount>this.seriesColor.length)for(c=
this.seriesColor.length;c<a.seriesCount;c++)this.seriesColor[c]="000";else if(a.seriesCount<this.seriesColor.length)for(c=this.seriesColor.length-1;c>=a.seriesCount;c--)this.seriesColor.pop();if(a.seriesCount>this.seriesCount)for(c=this.seriesCount;c<a.seriesCount;c++){if("lct_line"==this.type){this.buffer[c]=[];for(var e=0==this.seriesCount?this.bufferSize+1:this.buffer[0].length,d=0;d<e;d++)this.buffer[c][d]=this.dummyData;0==this.seriesCount?setTimeout(this.updateData.bind(this,c),0):this.newLines.push(c)}if("lct_line"==
this.type||"lct_sampledline"==this.type)this.data[c]=d3.range(this.dataCount).map(function(){return this.dummyData}.bind(this)),this._createLine(c)}else for(c=this.seriesCount-1;c>=a.seriesCount;c--)if("lct_line"==this.type&&this.buffer.pop(),"lct_line"==this.type||"lct_sampledline"==this.type)this.data.pop(),this.line.pop(),this.path.pop().remove();this.seriesCount=a.seriesCount}(a.seriesColor||a.seriesCount&&this.seriesCount!=a.seriesCount)&&this._createSeriesCSS();if(this.legendLabels&&(a.seriesColor||
a.seriesCount&&this.seriesCount!=a.seriesCount)||a.legendLabels)this.legendLabels?this.legend.remove():(this.margin.bottom+=20,b=!0),a.legendLabels&&(this.legendLabels=a.legendLabels);b&&(this.height=dojo.position(this.container).h-this.margin.top-this.margin.bottom,this.clipPathRect.attr("height",this.height),this.scale_y.range([this.height,0]),this.axisXG&&this.axisXG.attr("transform","translate(0,"+this.height+")"));if(a.dataMin||a.dataMax)a.dataMin&&(this.dataMin=a.dataMin),a.dataMax&&(this.dataMax=
a.dataMax),this.scale_y.domain([this.dataMin,this.dataMax]),this.axisYG.call(this.axisY);(this.legendLabels&&(a.seriesColor||a.seriesCount&&this.seriesCount!=a.seriesCount)||a.legendLabels)&&this._paintLegend();this._paintData()},_removeSeriesCSS:function(){for(var a=0;a<this.seriesCount;a++)G_UI_COM.removeCSSRule("series"+this.id+"_"+a)},_createSeriesCSS:function(){if("lct_line"==this.type||"lct_sampledline"==this.type)for(var a=0;a<this.seriesCount;a++)G_UI_COM.createCSSRule("series"+this.id+"_"+
a,"fill: none; stroke: #"+this.seriesColor[a]+"; stroke-width: 1.5px;");if("lct_column"==this.type)for(a=0;a<this.seriesCount;a++)G_UI_COM.createCSSRule("series"+this.id+"_"+a,"fill: #"+this.seriesColor[a])},_paintData:function(){switch(this.type){case "lct_line":case "lct_sampledline":this.scale_x.range([0,this.width]);for(var a=0;a<this.seriesCount;a++)this.path[a].attr("d",this.line[a]);break;case "lct_column":this.scale_x.rangeRoundBands([0,this.width],0.1),this._paintColumns()}},applyScale:function(){var a=
dojo.position(this.container);this.width=a.w-this.margin.left-this.margin.right;this.height=a.h-this.margin.top-this.margin.bottom;this.svg.attr("width",this.width+this.margin.left+this.margin.right).attr("height",this.height+this.margin.top+this.margin.bottom);this.clipPathRect.attr("width",this.width).attr("height",this.height);this.scale_y.range([this.height,0]);this.axisYG.call(this.axisY);this._paintData();this.axisXG&&this.axisXG.attr("transform","translate(0,"+this.height+")").call(this.axisX).selectAll("text").style("text-anchor",
"end");this.chartCaption&&this.chartCaption.attr("x",this.width/2).attr("y",-(this.margin.top-20))},postCreate:function(){this.inherited(arguments);this.set("content",'<div id="'+this.id+'_container" style="width:100%; height:100%;"></div>');this.set("style","overflow: hidden");setTimeout(this.createChart.bind(this),0)},stop:function(){this.stopped=!0;this.sfParams.action="stop";G_SERVER_COM.callServerFunction(this.sfClass,this.sfFunc,this.sfUidPath,this.sfParams)},start:function(){if(this.stopped){this.stopped=
!1;switch(this.type){case "lct_line":for(var a=0;a<this.seriesCount;a++)this._createLine(a);for(a=this.dataIdx=0;a<this.seriesCount;a++){this.buffer[a]=[];for(var b=0;b<=this.bufferSize;b++)this.buffer[a][b]=this.dummyData}break;case "lct_sampledline":for(a=0;a<this.seriesCount;a++)this._createLine(a)}this.initClass?G_SERVER_COM.callServerFunction(this.initClass,this.initFunc,this.initUidPath,this.initParams,this._initCallback.bind(this)):this._start()}},_initData:function(){for(var a=0;a<this.seriesCount;a++)this.data[a]=
d3.range(this.dataCount).map(function(){return this.dummyData}.bind(this))},_createLine:function(a){this.line[a]=d3.svg.line().interpolate(this.interpolation).x(function(a,c){return this.scale_x(c)}.bind(this)).y(function(a,c){return this.scale_y(a)}.bind(this));this.path[a]=this.svgMainG.append("g").attr("clip-path","url(#clip)").append("path").data([this.data[a]]).attr("class","series"+this.id+"_"+a).attr("d",this.line[a])},_initCallback:function(a,b,c,d){if(b){a=dojo.fromJson(c.output);switch(this.type){case "lct_line":for(b=
0;b<a.length;b++){c=this.bufferSize+1;d=!0;this.buffer[b]=[];for(var e=a[b].length-1;0<=e;e--)if(d)c--,this.buffer[b][c]=a[b][e],0==c&&(d=!1,c=this.dataCount);else if(c--,this.data[b][c]=a[b][e],0==c)break;if(d&&0<c)for(e=c-1;0<=e;e--)this.buffer[b][e]=this.dummyData;d&&(c=this.dataCount);if(0<c)for(e=c-1;0<=e;e--)this.data[b][e]=this.dummyData}if(this.seriesCount>a.length)for(b=a.length;b<this.seriesCount;b++)this._fillWithDummyData(b);break;case "lct_sampledline":case "lct_column":this.setData(a)}this._start()}else console.error("Server Function Error => "+
c.cn+"."+c.fn+": "+c.error)},_start:function(){this.sfParams.action="start";G_SERVER_COM.callServerFunction(this.sfClass,this.sfFunc,this.sfUidPath,this.sfParams);switch(this.type){case "lct_line":this._animationStart_1=new Date-this.updateInterval;this._animationStart_2=this._animationStart_1-this.updateInterval;this._oldAnimationTime_2=this._oldAnimationTime_1=this.updateInterval;for(var a=this._doNotCalc=0;a<this.seriesCount;a++)this.updateData(a)}},setData:function(a,b){if(!this.stopped)switch(this.type){case "lct_line":this._setLineData(a,
b);break;case "lct_sampledline":this._setSampledLineData(a);break;case "lct_column":this._setColumnData(a)}},_setSampledLineData:function(a){if(this._setCompleteData(a))for(a=0;a<this.seriesCount;a++)this.path[a].attr("d",this.line[a])},_setLineData:function(a,b){if(a.length!=this.seriesCount)console.error("Live Chart "+this.id+": received data points count ("+a.length+") does not match series count ("+this.seriesCount+")");else if(this.dataIdx==b){for(var c=0;c<this.seriesCount;c++)this.buffer[c].push(a[c]);
this.dataIdx++}else if(b<this.dataIdx)this._dataToLate=10*this.bufferSize;else for(c=0;c<this.seriesCount;c++){for(var d=0;d<b-this.dataIdx;d++)this.buffer[c].push(this.dummyData);this.buffer[c].push(a[c]);this.dataIdx=this.dataIdx+(b-this.dataIdx)+1}},_setColumnData:function(a){this._setCompleteData(a)&&this._paintColumns()},_setCompleteData:function(a){if(a.length!=this.seriesCount)return console.error("Live Chart "+this.id+": received data sets count ("+a.length+") does not match series count ("+
this.seriesCount+")"),!1;for(var b=0;b<this.seriesCount;b++)for(var c=0;c<a[b].length;c++){if(a[b].length!=this.dataCount)return console.error("Live Chart "+this.id+": received data count ("+a[b].length+") for set "+b+" does not match data count ("+this.dataCount+")"),!1;this.data[b][c]=a[b][c]}return!0},updateData:function(a){if(!this.stopped)if(this.seriesCount<=a)this._doNotCalc&&(this._doNotCalc=this._doNotClac-1);else{if(0==this.buffer[a].length){this.dataIdx++;for(var b=0;b<this.seriesCount;b++)this.buffer[b].push(this.dummyData)}this.data[a].push(this.buffer[a].shift());
if(this._doNotCalc)this._doNotCalc=this._doNotClac-1;else for(this._doNotCalc=this.seriesCount-1,this._animationTime=this.updateInterval-(this._animationStart_1-this._animationStart_2-this._oldAnimationTime_2),this._animationTime<this.updateInterval/2&&(this._animationTime=this.updateInterval/2),this.buffer[a].length>this.bufferSize&&(this._animationTime-=this.updateInterval/10),this.buffer[a].length<this.bufferSize&&(this._dataToLate=10),this._dataToLate&&(this._dataToLate-=1,this._animationTime+=
this.updateInterval/10),this._oldAnimationTime_2=this._oldAnimationTime_1,this._oldAnimationTime_1=this._animationTime,this._animationStart_2=this._animationStart_1,this._animationStart_1=new Date;0<this.newLines.length;)setTimeout(this.updateData.bind(this,this.newLines.pop()),0);this.path[a].attr("d",this.line[a]).attr("transform",null).transition().duration(this._animationTime).ease("linear").attr("transform","translate("+this.scale_x(0)+")").each("end",this.updateData.bind(this,a));this.data[a].shift()}},
createChart:function(){this.container=dojo.byId(this.id+"_container");this._initData();this._createSeriesCSS();""!=this.caption&&(this.margin.top+=20);this.legendLabels&&(this.margin.bottom+=20);var a=dojo.position(this.container);this.svg=d3.select(this.container).append("svg").attr("width",a.w).attr("height",a.h);this.svgMainG=this.svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")");this.width=a.w-this.margin.left-this.margin.right;""!=this.captiom&&(this.chartCaption=
this.svgMainG.append("text").attr("x",this.width/2).attr("y",-(this.margin.top-20)).attr("text-anchor","middle").attr("class","firmosLiveChartCaption").text(this.caption));switch(this.type){case "lct_line":this.domainX=[1,this.dataCount-2];this.scale_x=d3.scale.linear().domain(this.domainX).range([0,this.width]);break;case "lct_sampledline":this.domainX=[0,this.dataCount-1];this.scale_x=d3.scale.linear().domain(this.domainX).range([0,this.width]);break;case "lct_column":this.domainX=this.dataLabels?
d3.range(this.dataCount).map(function(a){return this.dataLabels[a]}.bind(this)):d3.range(this.dataCount).map(function(a){return a}),this.scale_x=d3.scale.ordinal().domain(this.domainX).rangeRoundBands([0,this.width],0.1)}this.dataLabels&&(this.axisX=d3.svg.axis().scale(this.scale_x).orient("bottom"),this.axisXG=this.svgMainG.append("g").attr("class","x d3axis").call(this.axisX),this._adjustAxisX());this.height=a.h-this.margin.top-this.margin.bottom;this.axisXG&&this.axisXG.attr("transform","translate(0,"+
this.height+")");this.legendLabels&&this._paintLegend();this.clipPath=this.svgMainG.append("defs").append("clipPath").attr("id","clip");this.clipPathRect=this.clipPath.append("rect").attr("width",this.width).attr("height",this.height);this.scale_y=d3.scale.linear().domain([this.dataMin,this.dataMax]).range([this.height,0]);this.axisY=d3.svg.axis().scale(this.scale_y).ticks(this.dataTickHint).orient("left");this.axisYG=this.svgMainG.append("g").attr("class","y d3axis").call(this.axisY);this.start();
this._events.push(dojo.connect(this,"resize",this.applyScale.bind(this)))},_adjustAxisX:function(){var a=0;this.axisXG.selectAll("text").style("text-anchor","end").attr("transform",function(a){return"rotate(-90)"}).attr("transform",function(b){b=this.getBoundingClientRect();ySpace=b.bottom-b.top;ySpace>a&&(a=ySpace);return"rotate(-90) translate(-5,"+(b.left-b.right)+")"});this.margin.bottom=this.margin.bottom-this.axisXMargin+a;this.axisXMargin=a},_paintLegend:function(){this.legendSize=0;this.legend=
this.svgMainG.append("g");for(var a=0;a<this.seriesCount;a++){this.legendItems[a]=this.legend.append("g").attr("class","legend");this.legendItems[a].append("rect").attr("x",this.legendSize).attr("y",-5).attr("width",18).attr("height",2).style("fill","#"+this.seriesColor[a]);this.legendSize+=25;var b=this.legendItems[a].append("text").attr("x",this.legendSize).text(this.legendLabels[a]);this.legendSize=this.legendSize+b[0][0].getBBox().width+20}this.legentSize=this.legendSize-20;this.legend.attr("transform",
"translate("+(this.width/2-this.legendSize/2)+","+(this.height+this.margin.top-10)+")")},_paintColumns:function(){for(var a=0;a<this.seriesCount;a++){var b=this.svgMainG.selectAll(".series"+this.id+"_"+a).data(this.data[a]);b.enter().append("rect").attr("class","series"+this.id+"_"+a);var c=0<this.dataMin?this.dataMin:0;b.attr("x",function(a,b){return this.scale_x(this.domainX[b])}.bind(this)).attr("width",this.scale_x.rangeBand()).attr("y",function(a,b){return this.scale_y(a)}.bind(this)).attr("height",
function(a,b){return a<this.dataMin?0:this.scale_y(c)-this.scale_y(a)}.bind(this));b.exit().remove()}}});dojo.declare("FIRMOS.Chart",dojox.charting.widget.Chart,{constructor:function(a){this.store_=a.store;this.type=a.type;this.seriesIds_=a.seriesids;this.title=a.title;this.storeAdapters_=[];if(a.labels){this.labels_=[];for(var b="ct_column"==this.type?1:0,c=0;c<a.labels.length;c++)this.labels_[c]={value:c+b,text:a.labels[c]}}G_UI_COM.registerStoreView(a.store.id,this)},destroy:function(){for(var a=
0;a<this.storeAdapters_.length;a++)this.storeAdapters_[a].destroy();G_UI_COM.unregisterStoreView(this.store.id,this);this.inherited(arguments);this.firstRenderListener_&&(this.firstRenderListener_.remove(),this.firstRenderListener_=null)},_getValueFunc:function(a){var b={};b.y=a.value;a.color&&(b.color=a.color);a.text&&(b.text=a.text);a.legend&&(b.legend=a.legend);return b},_addSeries:function(){this.chart.setTheme(dojox.charting.themes.Firmos);for(var a=0;a<this.seriesIds_.length;a++)this.storeAdapters_.push(new FIRMOS.StoreSeries(this.store_,
{query:{sId:this.seriesIds_[a]}},this._getValueFunc,this.id)),this.chart.addSeries(this.seriesIds_[a],this.storeAdapters_[this.storeAdapters_.length-1]);var a={},b={vertical:!0},c={markers:!0,gap:2};switch(this.type){case "ct_pie":c.type="Pie";break;case "ct_column":c.type="ClusteredColumns";this.labels_&&(a.dropLabels=!1,a.labels=this.labels_,a.rotation=90);a.dropLabels=!1;b.includeZero=!0;0<this.maxValue&&(b.max=this.maxValue);break;case "ct_line":c.type="Lines",this.labels_&&(a.labels=this.labels_),
b.includeZero=!0}this.chart.addAxis("x",a);this.chart.addAxis("y",b);this.chart.title=this.title;this.chart.addPlot("default",c);this.showlegend&&(this.firstRenderListener_=dojo.connect(this.chart,"render",this._showLegend.bind(this)))},_showLegend:function(){this.firstRenderListener_&&(this.firstRenderListener_.remove(),this.firstRenderListener_=null);this.getParent().getParent().getChildren()[1].content.refresh();this.getParent().getParent().layout()},buildRendering:function(){this.inherited(arguments);
setTimeout(this._addSeries.bind(this),0)}});dojo.declare("FIRMOS.TopMenu",dijit.layout.BorderContainer,{constructor:function(a){this._events=[]},destroy:function(){for(;0<this._events.length;)this._events.pop().remove()},postCreate:function(){this.inherited(arguments);var a=new dijit.layout.ContentPane({region:"top",splitter:!1,"class":"firmosTransparent"}),b;b='<div class="topMenu"><div class="topMenuLogoLeft"></div>';b+='<div class="topMenuLogoRight"></div>';b+='<div class="buttonListWrapper">';
for(var c,d,e=0;e<this.entries.length;e++)this.entries[e].isBig?(c="53",d="Big"):(c="38",d=""),G_UI_COM.createCSSRule("topMenu"+this.entries[e].entryId,"background: url("+this.entries[e].icon+"); background-repeat: no-repeat; background-size:"+c+"px "+c+"px; background-position: center;"),b=b+'<div class="buttonListItem"><div id="topMenu'+this.entries[e].entryId+'" class="menuButton'+d+'"><div class="base"><div class="shineTop"><div class="buttonIcon topMenu'+this.entries[e].entryId+'"><div class="shineBottom"></div></div></div></div><div class="captionContainer"><div class="buttonCaption">'+
this.entries[e].caption+"</div></div></div></div>";b+="</div></div>";a.set("content",b);this.addChild(a);setTimeout(this._registerButtons.bind(this),0)},_registerButtons:function(){this.layout();for(var a=0;a<this.entries.length;a++){var b=dojo.byId("topMenu"+this.entries[a].entryId);this._events.push(dojo.connect(b,dojox.gesture.tap,this.onClickHandler.bind(this,a)))}},onClickHandler:function(a,b){this.entries[a].isDialog?this.entries[a].isJira?window._showCollectorDialog?window._showCollectorDialog():
console.error("JIRA integration not included!"):G_SERVER_COM.callServerFunction(this.entries[a]["class"],this.entries[a].func,this.entries[a].uidpath,this.entries[a].params):G_UI_COM.showSectionPath(this.subSecsId,[this.entries[a].entryId],!0)}});dojo.declare("FIRMOS.Sitemap",dijit.layout.BorderContainer,{constructor:function(){this._events=[];this.mainEntriesBB=this.mainEntriesGroupGFX=this.mainEntriesSurface=this.mainEntriesContainer=this.detailsCP=this.mainEntriesCP=null;this.mainEntriesMoveCtrl=
!1;this.mainEntriesMoveCtrlDownGFX=this.mainEntriesMoveCtrlUpGFX=null;this.mainEntriesPos=0;this.detailsDim=this.detailsSurface=this.detailsContainer=null;this.detailsMinVisibleSection=100;this.animationRunning=!1;this.toggleAnimationDuration=500;this.focusElementAnimationDuration=250;this.minimizedScale=0.05;this.levelScale=0.6;this.moveFactor=0.2;this.lastMove_=(new Date).getTime();this.moving_=!1;this.mouseWheelDivisor=this.moveToClickTimeMin=100;this.pinchDivisor=5;G_UI_COM.registerSitemap(this)},
destroy:function(){for(G_UI_COM.unregisterSitemap(this);0<this._events.length;)this._events.pop().remove();this.inherited(arguments);this.mainEntriesMoveEndEvent&&(this.mainEntriesMoveEndEvent.remove(),this.mainEntriesMoveEndEvent=null)},postCreate:function(){this.inherited(arguments);this.mainEntriesCP=new dijit.layout.ContentPane({region:"left",splitter:!1,"class":"firmosTransparent"});this.mainEntriesCP.set("content",'<div id="'+this.id+'_me_gfx" style="width:100%; height:100%;"></div>');this.mainEntriesCP.set("style",
"width: 140px; overflow: hidden");this.detailsCP=new dijit.layout.ContentPane({region:"center",splitter:!1,"class":"firmosTransparent"});this.detailsCP.set("content",'<div id="'+this.id+'_d_gfx" style="width:100%; height:100%;"></div>');this.detailsCP.set("style","width: 100%; overflow: hidden");this.addChild(this.mainEntriesCP);this.addChild(this.detailsCP);setTimeout(this.buildSitemap.bind(this),0)},buildSitemap:function(){for(var a=this.getParent(),b=this;a;)a.isInstanceOf(FIRMOS.TabContainer)&&
(b._fixContent=!0),b=a,a=b.getParent();this.mainEntriesContainer=dojo.byId(this.id+"_me_gfx");this.mainEntriesSurface=dojox.gfx.createSurface(this.id+"_me_gfx","100%","100%");this.detailsContainer=dojo.byId(this.id+"_d_gfx");this.detailsSurface=dojox.gfx.createSurface(this.id+"_d_gfx","100%","100%");this.buildSVGDefs();b=!1;for(a=0;a<this.entries.length;a++)this.entries[a].entries?(this.entries[a].collapsed=b,b=!0):this.entries[a].collapsed=!0;if(1==this.entries.length)this.mainEntriesCP.set("style",
"display: none"),this._fixEntriesDataType(this.entries[0]);else for(this.mainEntriesGroupGFX=this.mainEntriesSurface.createGroup(),a=0;a<this.entries.length;a++)b=this.mainEntriesGroupGFX.createGroup(),this.entries[a].groupGFX=b,this.entries[a].x=80,this.entries[a].y=0==a?30:this.entries[a-1].y+this.entries[a-1].height+30,this.createEntry(b,this.entries[a],!1),this.entries[a].collapsed||(this.entries[a].elementGFX.rawNode.childNodes[0].setAttribute("class","firmosSitemapEntryPressed"),this.entries[a].elementGFX.rawNode.childNodes[1].setAttribute("class",
"firmosSitemapEntryPressed2")),this.createShortcut(this.entries[a]);b=[];this.detailsDim=dojo.position(this.detailsContainer);for(a=0;a<this.entries.length;a++)if(this.entries[a].childrenGroupMoveGFX=this.detailsSurface.createGroup(),this.entries[a].childrenGroupGFX=this.entries[a].childrenGroupMoveGFX.createGroup(),this.entries[a].activeLevel=1,this.entries[a].levelScale=1,this.entries[a].maxLevel=1,this.entries[a].maxLevelScale=1,b[0]=a,0<this.entries[a].entries.length){this.buildDetails(this.entries[a],
b,null,this.entries[a].childrenGroupGFX);for(var c=1;c<this.entries[a].maxLevel;c++)this.entries[a].maxLevelScale/=this.levelScale;c=this.entries[a].childrenGroupGFX.getBoundingBox();this.entries[a].eventRect=this.entries[a].childrenGroupMoveGFX.createRect({x:c.x-this.detailsDim.w,y:c.y-this.detailsDim.h,width:c.width+2*this.detailsDim.w,height:c.height+2*this.detailsDim.h}).setFill([0,0,0,0]).moveToBack();c=dojox.gfx.Moveable(this.entries[a].childrenGroupMoveGFX);this._events.push(dojo.connect(c,
"onMoveStop",this._moveActionStop.bind(this)));this._events.push(dojo.connect(c,"onMove",this._moveAction.bind(this)));this._events.push(dojo.connect(this.entries[a].eventRect.getEventSource(),dojox.gesture.tap.doubletap,this.resetDisplay.bind(this,this.entries[a])));this._events.push(dojo.connect(this.entries[a].eventRect.getEventSource(),"gesturechange",this.gestureHandler.bind(this,this.entries[a])));c=dojo.isMozilla?"DOMMouseScroll":"onmousewheel";this._events.push(dojo.connect(this.entries[a].childrenGroupMoveGFX.getEventSource(),
"gesturechange",this.gestureHandler.bind(this,this.entries[a])));this._events.push(dojo.connect(this.entries[a].childrenGroupMoveGFX.getEventSource(),c,this.gestureHandler.bind(this,this.entries[a])))}else this.entries[a].path=dojo.clone(b);1<this.entries.length&&(this.mainEntriesBB=this.mainEntriesGroupGFX.getBoundingBox());this.resizeSVGHandler();this.layout();setTimeout(this._initialLayoutDetails.bind(this),0);this._events.push(dojo.connect(this,"resize",this.resizeSVGHandler.bind(this)))},gestureHandler:function(a,
b){if(this.animationRunning)setTimeout(this.gestureHandler.bind(this,a,b),100);else{if(b.scale)var c=1+(b.scale-1)/this.pinchDivisor;else c=b[dojo.isMozilla?"detail":"wheelDelta"]*(dojo.isMozilla?-1:1),c=1+c/this.mouseWheelDivisor;var d=a.levelScale*c;1>d&&(d=1,c=d/a.levelScale);d>a.maxLevelScale&&(d=a.maxLevelScale,c=d/a.levelScale);var e=dojo.position(this.domNode);a.levelScale=d;a.childrenGroupMoveGFX.applyLeftTransform(dojox.gfx.matrix.scaleAt(c,e.w/2-this.detailsDim.x,e.h/2));for(var c=2,e=1,
f=1/this.levelScale;f<d;)e=f,f/=this.levelScale,c+=1;d-e<f-d&&(c-=1);d=a.activeLevel;a.activeLevel=c;this.highlightActiveLevel(a,d)}},_initialLayoutDetails:function(){for(var a=0;a<this.entries.length;a++)0<this.entries[a].entries.length&&this.layoutDetails(this.entries[a])},_moveAction:function(){this.moving_=!0},_moveActionStop:function(){this.moving_&&(this.lastMove_=(new Date).getTime(),this._checkDetailsVisibility());this.moving_=!1},_checkDetailsVisibility:function(){for(var a=0;a<this.entries.length;a++)if(!1==
this.entries[a].collapsed){var b=this.entries[a].childrenGroupGFX.getTransformedBoundingBox(),c=this.detailsMinVisibleSection-b[1].x,d=this.detailsDim.w-this.detailsMinVisibleSection-b[0].x,e=this.detailsMinVisibleSection-b[2].y,b=this.detailsDim.h-this.detailsMinVisibleSection-b[1].y,f=!1;0<c?f=!0:c=0;0>d?f=!0:d=0;0<e?f=!0:e=0;0>b?f=!0:b=0;f&&this.entries[a].childrenGroupMoveGFX.applyTransform(dojox.gfx.matrix.translate(c+d,e+b));break}},layoutDetails:function(a){this._centerGFX(a.childrenGroupMoveGFX,
a.entries[0].elementGFX);if(a.collapsed){var b=a.childrenGroupMoveGFX.getTransformedBoundingBox(),c=a.groupGFX.getTransformedBoundingBox(),d=dojo.position(this.mainEntriesContainer);c[0].x-=d.w;c[1].x-=d.w;a.childrenGroupMoveGFX.moveToBack();a.childrenGroupMoveGFX.applyTransform(dojox.gfx.matrix.translate(c[0].x+(c[1].x-c[0].x)/2-b[0].x-(b[1].x-b[0].x)/2,c[1].y+(c[2].y-c[1].y)/2-b[1].y-(b[2].y-b[1].y)/2));a.childrenGroupMoveGFX.applyLeftTransform(dojox.gfx.matrix.scaleAt(this.minimizedScale,c[0].x+
(c[1].x-c[0].x)/2,c[1].y+(c[2].y-c[1].y)/2));a.childrenGroupMoveGFX.rawNode.style.display="none"}},buildDetails:function(a,b,c,d){a.path=dojo.clone(b);if(c)var e=a.elementGFX.getTransformedBoundingBox(),f=e[0].x+(e[1].x-e[0].x)/2,e=e[1].y+(e[2].y-e[1].y)/2;this.entries[b[0]].maxLevel=Math.max(this.entries[b[0]].maxLevel,b.length-1);for(var g=0;g<a.entries.length;g++){var h=d.createGroup();a.entries[g].groupGFX=h;this.createEntry(h,a.entries[g],1==a.path.length);var k=a.entries[g].groupGFX.getTransformedBoundingBox();
if(c){var l=a.entries[g].elementGFX.getTransformedBoundingBox(),m=l[0].x+(l[1].x-l[0].x)/2,l=l[1].y+(l[2].y-l[1].y)/2,n=d.createRect({x:0,y:0,width:0,height:0});a.entries[g].connector=n;n.rawNode.setAttribute("style",'fill: url("/#connectorgradient"); fill-opacity: 1;');this.repaintConnector(n,m,l,f,e,5)}b.push(g);this.buildDetails(a.entries[g],b,k,h);b.pop();c&&(h=(f-m)*this.moveFactor,k=(e-l)*this.moveFactor,a.entries[g].connector.applyLeftTransform(dojox.gfx.matrix.translate((f-m)*this.moveFactor,
(e-l)*this.moveFactor)),a.entries[g].connector.applyLeftTransform(dojox.gfx.matrix.scaleAt(1-this.moveFactor,m+(f-m)*this.moveFactor,l+(e-l)*this.moveFactor)),a.entries[g].groupGFX.applyTransform(dojox.gfx.matrix.translate(h,k)),a.entries[g].groupGFX.applyLeftTransform(dojox.gfx.matrix.scaleAt(this.levelScale,m+h,l+k)))}},repaintConnector:function(a,b,c,d,e,f){var g=d-b,h=e-c;e=b+g/2;c+=h/2;g=Math.sqrt(g*g+h*h);h=Math.asin(h/g);d<b&&(h=-h);a.setShape({x:e-g/2,y:c-f/2,width:g,height:f});a.applyTransform(dojox.gfx.matrix.rotateAt(h,
e,c)).moveToBack();a._originalTrans=a.getTransform()},_fixEntriesDataType:function(a){a.entries?a.entries instanceof Array||(a.entries=[a.entries]):a.entries=[]},createEntry:function(a,b,c){this._fixEntriesDataType(b);a=a.createGroup();b.elementGFX=a;b.width=100;b.height=b.icon?78:35;var d="";c&&(d="AL");c=a.createPath({path:"M117.084,49.496c0,1.105-0.941,2-2.103,2h-"+b.width+"c-1.161,0-2.103-0.895-2.103-2v-"+b.height+"c0-1.104,0.941-2,2.103-2h"+b.width+"c1.161,0,2.103,0.896,2.103,2V49.496z"});c.applyTransform(dojox.gfx.matrix.translate(b.x-
67.2,b.y));var e=a.createPath({path:"M115.75,48.171c0,1.012-0.915,1.829-2.042,1.829h-"+(b.width-2.879)+"c-1.127,0-2.042-0.817-2.042-1.829v-"+(b.height-2.908)+"c0-1.009,0.915-1.829,2.042-1.829h"+(b.width-2.879)+"c1.127,0,2.042,0.82,2.042,1.829V48.171z"});e.applyTransform(dojox.gfx.matrix.translate(b.x-67.2,b.y));var f=c.getTransformedBoundingBox();if(b.icon){a.createImage({x:f[0].x+(f[1].x-f[0].x)/2-24,y:f[1].y+5,width:48,height:48,src:b.icon,preserveAspectRatio:"meet"});var g=f[1].y+48+20}else g=
f[1].y+(f[2].y-f[1].y)/2+5;f=a.createText({x:f[0].x+(f[1].x-f[0].x)/2,y:g,text:b.caption,align:"center"}).setFont({family:"Arial",size:"10pt"}).setFill("white");f.applyTransform(dojox.gfx.matrix.translate(-f.getTextWidth()/2,0));f.getTextWidth()>b.width-10&&(f=f.getTextWidth()-b.width+10,b.width+=f,c.setShape({path:"M117.084,49.496c0,1.105-0.941,2-2.103,2h-"+b.width+"c-1.161,0-2.103-0.895-2.103-2v-"+b.height+"c0-1.104,0.941-2,2.103-2h"+b.width+"c1.161,0,2.103,0.896,2.103,2V49.496z"}),e.setShape({path:"M115.75,48.171c0,1.012-0.915,1.829-2.042,1.829h-"+
(b.width-2.879)+"c-1.127,0-2.042-0.817-2.042-1.829v-"+(b.height-2.908)+"c0-1.009,0.915-1.829,2.042-1.829h"+(b.width-2.879)+"c1.127,0,2.042,0.82,2.042,1.829V48.171z"}),c.applyTransform(dojox.gfx.matrix.translate(f/2,0)),e.applyTransform(dojox.gfx.matrix.translate(f/2,0)));b.disabled?(c.rawNode.setAttribute("class","firmosSitemapEntryDisabled"+d),e.rawNode.setAttribute("class","firmosSitemapEntryDisabled2")):(c.rawNode.setAttribute("class","firmosSitemapEntry"+d),e.rawNode.setAttribute("class","firmosSitemapEntry2"));
d=a.getTransformedBoundingBox();a.createRect({x:d[0].x,y:d[1].y,width:d[1].x-d[0].x,height:d[2].y-d[1].y}).setFill([0,0,0,0]);this._events.push(dojo.connect(a.getEventSource(),dojox.gesture.tap,this.elementOnClick.bind(this,b,!1)));1!=b.scale&&(d=a.getTransformedBoundingBox(),a.applyLeftTransform(dojox.gfx.matrix.scaleAt(b.scale,d[0].x+(d[1].x-d[0].x)/2,d[1].y+(d[2].y-d[1].y)/2)));this.createInfoUI(b)},createInfoUI:function(a){if(0<a.newscount)if(a.infoGFX){var b=0;if(99<a.newscount){var c=8;100>
a.newscount_old&&(b=-1)}else 99<a.newscount_old&&(b=1),c=10;delete a.newscount_old;var d=a.infoGFX.children[2],e=d.getTextWidth();d.setShape({text:a.newscount+""}).setFont({size:c+"pt"});d.applyTransform(dojox.gfx.matrix.translate(e/2-d.getTextWidth()/2,b))}else b=a.elementGFX.getBoundingBox(),e=a.groupGFX.createGroup(),e.createCircle({cx:b.x+b.width,cy:b.y,r:12}).setFill("white"),e.createCircle({cx:b.x+b.width,cy:b.y,r:10}).setFill("red"),c=99<a.newscount?8:10,d=e.createText({x:b.x+b.width+1,y:b.y+
c/2,text:a.newscount+""}).setFont({family:"Arial",size:c+"pt"}).setFill("white"),d.applyTransform(dojox.gfx.matrix.translate(-d.getTextWidth()/2,0)),1!=a.scale&&(e.applyLeftTransform(dojox.gfx.matrix.scaleAt(a.scale,b.x+b.width,b.y)),e.applyTransform(dojox.gfx.matrix.translate(-b.width*(1-a.scale)/2,b.height*(1-a.scale)/2))),a.infoGFX=e;else a.infoGFX&&(a.infoGFX.destroy(),delete a.infoGFX,delete a.newscount_old)},_isShortcutDisabled:function(a){if(!a.entries)return!0;for(var b=0;b<a.entries.length;b++)if(!a.entries[b].disabled||
this._isShortcutDisabled(a.entries[b]))return!1;return!0},createShortcut:function(a){var b=a.disabled||this._isShortcutDisabled(a),c=b?"firmosSMShortcutDisabled":"firmosSMShortcutEnabled",d=a.elementGFX.getBoundingBox(),e=a.groupGFX.createGroup(),f=e.createPath({path:"M19.158,32.64c-2.551,0-5.035-0.738-7.185-2.134c-2.961-1.922-4.995-4.882-5.729-8.334c-0.733-3.452-0.078-6.983,1.844-9.943c2.447-3.77,6.595-6.02,11.094-6.02c2.55,0,5.034,0.738,7.183,2.134c2.961,1.922,4.996,4.882,5.73,8.335c0.734,3.452,0.079,6.984-1.844,9.944C27.805,30.391,23.658,32.64,19.158,32.64z"});
f.rawNode.setAttribute("class",c+"1");f=e.createPath({path:"M19.184,5.709v1c2.453,0,4.842,0.71,6.91,2.053c2.849,1.85,4.807,4.698,5.513,8.02c0.706,3.321,0.076,6.72-1.774,9.568c-2.354,3.625-6.345,5.79-10.675,5.79c-2.454,0-4.844-0.71-6.913-2.053c-2.848-1.85-4.806-4.697-5.511-8.019c-0.706-3.321-0.076-6.719,1.774-9.567c2.354-3.626,6.345-5.792,10.674-5.792L19.184,5.709M19.183,5.709c-4.488,0-8.886,2.202-11.513,6.248C3.544,18.308,5.347,26.8,11.701,30.926c2.308,1.499,4.896,2.214,7.457,2.214c4.489,0,8.888-2.201,11.514-6.246c4.126-6.353,2.32-14.846-4.033-18.971C24.331,6.425,21.742,5.709,19.183,5.709L19.183,5.709z"});
f.rawNode.setAttribute("class",c+"2");f=e.createPath({path:"M0.2-20.001c-10.906,0-19.779,8.874-19.779,19.78c0,10.907,8.873,19.781,19.779,19.781c4.679,0,8.971-1.644,12.356-4.373l-9.806-8.48l25.828-3.813l-0.05,26.107l-9.07-7.845c-5.101,4.599-11.85,7.404-19.259,7.404c-15.894,0-28.779-12.887-28.779-28.781s12.886-28.78,28.779-28.78c12.468,0,23.081,7.928,27.08,19.016l-9.199,1.359C14.913-15.336,8.1-20.001,0.2-20.001z"});f.rawNode.setAttribute("class",c+"3");f.applyTransform({xx:-0.2177,yx:0.1947,xy:0.2037,
yy:0.2278,dx:19.4619,dy:18.75});e.applyTransform(dojox.gfx.matrix.translate(d.x+d.width-25,d.y+d.height-18));1!=a.scale&&(e.applyLeftTransform(dojox.gfx.matrix.scaleAt(a.scale,d.x+d.width,d.y)),e.applyTransform(dojox.gfx.matrix.translate(-d.width*(1-a.scale)/2,-d.height*(1-a.scale)/2)));a.scGFX=e;b||this._events.push(dojo.connect(e.getEventSource(),dojox.gesture.tap,this.elementOnClick.bind(this,a,!0)))},_getEntryByPath:function(a){for(var b,c=this;0<a.length;){var d=a.shift();b=!0;for(var e=0;e<
c.entries.length;e++)if(d==c.entries[e].id){c=c.entries[e];b=!1;break}if(b){console.error("_getEntryByPath: Child "+d+" not found");return}}return c},updateInfoUI:function(a,b){var c=this._getEntryByPath(a);c.newscount_old=c.newscount;c.newscount=b;this.createInfoUI(c)},_buildSVGDef:function(a){var b=dojo.doc.createElementNS("http://www.w3.org/2000/svg",a.tagname);if(a.attrs){a.attrs instanceof Array||(a.attrs=[a.attrs]);for(var c=0;c<a.attrs.length;c++)b.setAttribute(a.attrs[c].name,a.attrs[c].value)}if(a.elems)for(a.elems instanceof
Array||(a.elems=[a.elems]),c=0;c<a.elems.length;c++){var d=this._buildSVGDef(a.elems[c]);b.appendChild(d)}return b},buildSVGDefs:function(){for(var a=this.mainEntriesSurface.rawNode.getElementsByTagName("defs")[0],b=this.detailsSurface.rawNode.getElementsByTagName("defs")[0],c=0;c<this.defs.length;c++){var d=this._buildSVGDef(this.defs[c]);a.appendChild(d);b.appendChild(d)}},_createEventRects:function(){this.detailsDim=dojo.position(this.detailsContainer);for(var a=0;a<this.entries.length;a++)if(0<
this.entries[a].entries.length){var b=this.entries[a].childrenGroupGFX.getBoundingBox();this.entries[a].eventRect.setShape({x:b.x-this.detailsDim.w,y:b.y-this.detailsDim.h,width:b.width+2*this.detailsDim.w,height:b.height+2*this.detailsDim.h})}this._checkDetailsVisibility()},resizeSVGHandler:function(){if(1<this.entries.length)if(this.mainEntriesCP.set("style","width: "+(2*this.mainEntriesBB.x+this.mainEntriesBB.width-1)+"px; overflow: hidden;"),setTimeout(function(){this.mainEntriesCP.set("style",
"width: "+(2*this.mainEntriesBB.x+this.mainEntriesBB.width)+"px; overflow: hidden;")}.bind(this),0),this.mainEntriesContainerDim=dojo.position(this.mainEntriesContainer),this.mainEntriesBB.y+this.mainEntriesBB.height>this.mainEntriesContainerDim.h)if(this.mainEntriesMoveCtrl){var a=this.mainEntriesBB.y+this.mainEntriesBB.height+this.mainEntriesPos-this.mainEntriesContainerDim.h;0<a?(this._createMoveCtrlDown(),this._repositionMoveCtrlDown()):(this._removeMoveCtrlDown(),this.mainEntriesGroupGFX.applyTransform(dojox.gfx.matrix.translate(0,
-a)),this.mainEntriesPos-=a)}else this.mainEntriesMoveCtrl=!0,this._createMoveCtrlDown();else this.mainEntriesMoveCtrl&&(this._removeMoveCtrlDown(),this._removeMoveCtrlUp(),this.mainEntriesMoveCtrl=!1,this.mainEntriesGroupGFX.applyTransform(dojox.gfx.matrix.translate(0,-this.mainEntriesPos)),this.mainEntriesPos=0);setTimeout(this._createEventRects.bind(this),1)},_createMoveCtrlDown:function(){this.mainEntriesMoveCtrlDownGFX||(this.mainEntriesMoveCtrlDownGFX=this.mainEntriesSurface.createGroup(),this.mainEntriesMoveCtrlDownGFX.createRect({x:10,
y:this.mainEntriesContainerDim.h-30,width:this.mainEntriesContainerDim.w-20,height:30}).setFill("blue"),this.mainEntriesMoveCtrlDownGFX.createPolyline([{x:15,y:this.mainEntriesContainerDim.h-25},{x:this.mainEntriesContainerDim.w-15,y:this.mainEntriesContainerDim.h-25},{x:this.mainEntriesContainerDim.w/2,y:this.mainEntriesContainerDim.h-5},{x:15,y:this.mainEntriesContainerDim.h-25}]).setFill("white"),this._repositionMoveCtrlDown(),this._events.push(dojo.connect(this.mainEntriesMoveCtrlDownGFX.getEventSource(),
dojo.touch.press,this.mainEntriesMoveHandler.bind(this,-1))))},_createMoveCtrlUp:function(){this.mainEntriesMoveCtrlUpGFX||(this.mainEntriesMoveCtrlUpGFX=this.mainEntriesSurface.createGroup(),this.mainEntriesMoveCtrlUpGFX.createRect({x:10,y:0,width:this.mainEntriesContainerDim.w-20,height:30}).setFill("blue"),this.mainEntriesMoveCtrlUpGFX.createPolyline([{x:15,y:25},{x:this.mainEntriesContainerDim.w-15,y:25},{x:this.mainEntriesContainerDim.w/2,y:5},{x:15,y:25}]).setFill("white"),this._events.push(dojo.connect(this.mainEntriesMoveCtrlUpGFX.getEventSource(),
dojo.touch.press,this.mainEntriesMoveHandler.bind(this,1))))},_removeMoveCtrlUp:function(){this.mainEntriesMoveCtrlUpGFX&&(this.mainEntriesMoveCtrlUpGFX.destroy(),this.mainEntriesMoveCtrlUpGFX=null)},_removeMoveCtrlDown:function(){this.mainEntriesMoveCtrlDownGFX&&(this.mainEntriesMoveCtrlDownGFX.destroy(),this.mainEntriesMoveCtrlDownGFX=null)},_moveMainEntries:function(a){0>a?(this._createMoveCtrlUp(),this.mainEntriesBB.y+this.mainEntriesBB.height+this.mainEntriesPos==this.mainEntriesContainerDim.h&&
(this._removeMoveCtrlDown(),this.mainEntriesMoveEndHandler())):(this._createMoveCtrlDown(),0==this.mainEntriesPos&&(this._removeMoveCtrlUp(),this.mainEntriesMoveEndHandler()));this.mainEntriesMoveEndEvent&&(this.mainEntriesGroupGFX.applyTransform(dojox.gfx.matrix.translate(0,a)),this.mainEntriesPos+=a,setTimeout(this._moveMainEntries.bind(this,a),10))},mainEntriesMoveHandler:function(a){this.mainEntriesMoveEndEvent&&this.mainEntriesMoveEndHandler();this.mainEntriesMoveEndEvent=dojo.connect(document,
dojo.touch.release,this.mainEntriesMoveEndHandler.bind(this));this._moveMainEntries(a)},mainEntriesMoveEndHandler:function(a){this.mainEntriesMoveEndEvent&&(this.mainEntriesMoveEndEvent.remove(),this.mainEntriesMoveEndEvent=null)},_repositionMoveCtrlDown:function(){if(this.mainEntriesMoveCtrlDownGFX){var a=this.mainEntriesMoveCtrlDownGFX.getTransformedBoundingBox()[2].y-this.mainEntriesContainerDim.h;0!=a&&this.mainEntriesMoveCtrlDownGFX.applyTransform(dojox.gfx.matrix.translate(0,-a))}},_centerGFX:function(a,
b){var c=dojo.position(this.domNode),d=b.getTransformedBoundingBox();a.applyLeftTransform(dojox.gfx.matrix.translate(c.w/2-this.detailsDim.x-(d[1].x-d[0].x)/2-d[0].x,c.h/2-(d[2].y-d[1].y)/2-d[1].y))},resetDisplay:function(a){if(!this.animationRunning){this.animationRunning=!0;var b=this._centerAndScale(a,a.levelScale),c=a.activeLevel;a.activeLevel=1;a.levelScale=1;this._events.push(dojo.connect(b,"onEnd",this.highlightActiveLevel.bind(this,a,c)));this._events.push(dojo.connect(b,"onEnd",this.animationEnd.bind(this,
a)))}},_centerAndScale:function(a,b){var c=dojo.position(this.domNode),d=a.entries[0].elementGFX.getTransformedBoundingBox();return(new dojox.gfx.fx.animateTransform({duration:this.toggleAnimationDuration,shape:a.childrenGroupMoveGFX,transform:[{name:"scaleAt",start:[1,d[0].x+(d[1].x-d[0].x)/2,d[1].y+(d[2].y-d[1].y)/2],end:[1/b,c.w/2-this.detailsDim.x,c.h/2]},{name:"translate",start:[0,0],end:[c.w/2-this.detailsDim.x-d[0].x-(d[1].x-d[0].x)/2,c.h/2-d[1].y-(d[2].y-d[1].y)/2]},{name:"original"}]})).play()},
elementToggleCollapse:function(a){!this.animationRunning&&a.collapsed&&(this.animationRunning=!0,this._elementExpand(a,!0))},_elementExpand:function(a,b){a.childrenGroupMoveGFX.getTransformedBoundingBox();for(var c=0;c<this.entries.length;c++)this.entries[c].collapsed||this._elementCollapse(this.entries[c],!1);a.childrenGroupMoveGFX.rawNode.style.display="";c=this._centerAndScale(a,this.minimizedScale);a.collapsed=!1;b&&(this._events.push(dojo.connect(c,"onEnd",this.animationEnd.bind(this,a))),this._events.push(dojo.connect(c,
"onEnd",this.expandElementEnd.bind(this,a))))},_elementCollapse:function(a,b){var c=a.childrenGroupMoveGFX.getTransformedBoundingBox(),d=a.groupGFX.getTransformedBoundingBox(),e=dojo.position(this.mainEntriesContainer);d[0].x-=e.w;d[1].x-=e.w;c=(new dojox.gfx.fx.animateTransform({duration:this.toggleAnimationDuration,shape:a.childrenGroupMoveGFX,transform:[{name:"scaleAt",start:[1,c[0].x+(c[1].x-c[0].x)/2,c[1].y+(c[2].y-c[1].y)/2],end:[this.minimizedScale,d[0].x+(d[1].x-d[0].x)/2,d[1].y+(d[2].y-d[1].y)/
2]},{name:"translate",start:[0,0],end:[d[0].x+(d[1].x-d[0].x)/2-c[0].x-(c[1].x-c[0].x)/2,d[1].y+(d[2].y-d[1].y)/2-c[1].y-(c[2].y-c[1].y)/2]},{name:"original"}]})).play();a.collapsed=!0;this._events.push(dojo.connect(c,"onEnd",this.collapseElementEnd.bind(this,a)));b&&this._events.push(dojo.connect(c,"onEnd",this.animationEnd.bind(this,a)))},animationEnd:function(a){this.animationRunning=!1},collapseElementEnd:function(a){a.elementGFX.rawNode.childNodes[0].setAttribute("class","firmosSitemapEntry");
a.elementGFX.rawNode.childNodes[1].setAttribute("class","firmosSitemapEntry2")},expandElementEnd:function(a){a.elementGFX.rawNode.childNodes[0].setAttribute("class","firmosSitemapEntryPressed");a.elementGFX.rawNode.childNodes[1].setAttribute("class","firmosSitemapEntryPressed2")},_highlightALRecursive:function(a,b,c,d){if(b<c||b<d)for(var e=0;e<a.entries.length;e++)this._highlightALRecursive(a.entries[e],b+1,c,d);b==c&&(a.disabled?a.elementGFX.rawNode.childNodes[0].setAttribute("class","firmosSitemapEntryDisabledAL"):
a.elementGFX.rawNode.childNodes[0].setAttribute("class","firmosSitemapEntryAL"));b==d&&(a.disabled?a.elementGFX.rawNode.childNodes[0].setAttribute("class","firmosSitemapEntryDisabled"):a.elementGFX.rawNode.childNodes[0].setAttribute("class","firmosSitemapEntry"))},highlightActiveLevel:function(a,b){a.activeLevel!=b&&this._highlightALRecursive(a,0,a.activeLevel,b)},elementOnClick:function(a,b,c){if(!(this.moving_||(new Date).getTime()-this.lastMove_<this.moveToClickTimeMin))if(c.preventDefault(),dojo.stopEvent(c),
1!=a.path.length||b){var d=!0;if(1<a.path.length){var e=this.entries[a.path[0]],f=1,g=a.path.length-1,h=e.activeLevel;if(h!=g){d=!1;if(this.animationRunning){setTimeout(this.elementOnClick.bind(this,a,b,c),100);return}this.animationRunning=!0;if(e.activeLevel<g)for(b=e.activeLevel;b<g;b++)f/=this.levelScale;else for(b=e.activeLevel;b>g;b--)f*=this.levelScale;e.activeLevel=g;g=e.levelScale*f;1>g&&(g=1,f=g/e.levelScale);g>e.maxLevelScale&&(g=e.maxLevelScale,f=g/e.levelScale);e.levelScale=g;var k=a.elementGFX.getTransformedBoundingBox(),
g=e.childrenGroupMoveGFX.getTransform();b=k[0].x+(k[1].x-k[0].x)/2;k=k[1].y+(k[2].y-k[1].y)/2;f=dojox.gfx.matrix.scaleAt(f,b,k);if(c.clientX&&c.clientY){var l=c.clientX-this.detailsDim.x;c=c.clientY-this.detailsDim.y}else l=b,c=k;c=dojox.gfx.matrix.translate(l-b,c-k);c=(new dojox.gfx.fx.animateTransform({duration:this.focusElementAnimationDuration,shape:e.childrenGroupMoveGFX,transform:[{name:"matrix",start:g,end:dojox.gfx.matrix.multiply(c,f,g)}]})).play();this._events.push(dojo.connect(c,"onEnd",
this.animationEnd.bind(this,a)));this._events.push(dojo.connect(c,"onEnd",this.highlightActiveLevel.bind(this,e,h)))}}d&&!a.disabled&&(d=a.sectionpath.sectionids instanceof Array?dojo.clone(a.sectionpath.sectionids):[a.sectionpath.sectionids],G_UI_COM.showSectionPathInProgress=!0,G_UI_COM.showSectionPath(a.sectionpath.basecontainerid,d,!1)||console.error("Could not resolve given section path: "+JSON.stringify(a.sectionpath)))}else this.elementToggleCollapse(a)}});dojo.declare("FIRMOS.gridPBColumn",
null,{constructor:function(a){for(var b in a)this[b]=a[b]},renderCell:function(a,b,c,d,e){c=new dijit.ProgressBar({style:"width: 100%"});c.set("value",b/this.maxValue*100);this.labelId&&c.set("label",a[this.labelId]+"");return c.domNode}});dojo.declare("FIRMOS.gridDetailsColumn",null,{constructor:function(){this.label="";this.className="dgrid-details";this.unhidable=!0;this._events=[];return this},destroy:function(){for(;0<this._events.length;)this._events.pop().remove()},renderCell:function(a,b,
c,d,e){b=dojo.create("div");this.grid.detailsClassname||a._detailsfunc_&&a._funcclassname_?(b.className="dgrid-details-closed",b.innerHTML="+",a=a&&this.grid.row(a),a._detailsOpen=!1,this._events.push(dojo.connect(b,"onclick",this.toggleDetails.bind(this,b,a)))):b.className="dgrid-details-none";return b},toggleDetails:function(a,b){b._detailsOpen?(a.className="dgrid-details-closed",a.innerHTML="+",this.grid.hideDetails(b)):(a.className="dgrid-details-open",a.innerHTML="-",this.grid.showDetails(b));
b._detailsOpen=!b._detailsOpen},renderHeaderCell:function(a){return""}});dojo.declare("FIRMOS.OnDemandGrid",[dgrid.OnDemandGrid,FIRMOS.GridBase,dgrid.Selection,FIRMOS.GridFilter,dgrid.ColumnResizer,FIRMOS.ColumnReorder,dgrid.ColumnHider,FIRMOS.GridDnD,dgrid.DijitRegistry]);dojo.declare("FIRMOS.Editor",dijit.layout.BorderContainer,{texts:G_TEXTS.editor,_editorStarted:!1,_savedContent:"",constructor:function(a){switch(a.contentType){case "ct_html":this.editorType="aloha";this.startEditAHandler=this.startEditA.bind(this);
this.pauseEditAHandler=this.pauseEditA.bind(this);break;case "ct_javascript":case "ct_pascal":this.editorType="codemirror";this.startEditCMHandler=this.startEditCM.bind(this);this.pauseEditCMHandler=this.pauseEditCM.bind(this);break;default:console.error("Unknown content type "+a.contentType)}},destroy:function(){switch(this.editorType){case "aloha":$(Aloha,"body").unbind("aloha-editable-activated",this.startEditAHandler);$(Aloha,"body").unbind("aloha-editable-deactivated",this.pauseEditAHandler);
break;case "codemirror":this.cm.off("focus",this.startEditCMHandler),this.cm.off("blur",this.pauseEditCMHandler)}this.editableContent&&this.editableContent.destroy();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.editorCP=new dijit.layout.ContentPane({region:"center",splitter:!1});this.editorCP.set("content",'<div id="'+this.id+'_container" style="width:100%; height:100%; background-color:#fff; overflow:hidden;" class="article"></div>');if(this.tbBottom){this.toolbar=
new dijit.Toolbar({region:"bottom"});var a=""}else this.toolbar=new dijit.Toolbar({region:"top"}),a="float:right;";this.saveButton=new dijit.form.Button({label:this.texts.saveButton,disabled:!0,onClick:this.save.bind(this),style:a});this.toolbar.addChild(this.saveButton);this.resetButton=new dijit.form.Button({label:this.texts.resetButton,disabled:!0,onClick:this.load.bind(this),style:a});this.toolbar.addChild(this.resetButton);this.addChild(this.toolbar);this.addChild(this.editorCP);setTimeout(this.startEditor.bind(this),
0)},startEditor:function(){switch(this.editorType){case "aloha":$("#"+this.id+"_container").aloha();this.editableContent=Aloha.getEditableById(this.id+"_container");Aloha.bind("aloha-editable-activated",this.startEditAHandler);Aloha.bind("aloha-editable-deactivated",this.pauseEditAHandler);break;case "codemirror":this.cm=CodeMirror(dojo.byId(this.id+"_container"),{lineNumbers:!0,mode:this.contentType.substring(3)});this.cm.on("focus",this.startEditCMHandler);this.cm.on("blur",this.pauseEditCMHandler);
break;default:return}this.load()},loadCallback:function(a,b,c,d){b&&""!=c.output&&(a=dojo.fromJson(c.output),this._savedContent=a.value,this.setValue(a.value))},getValue:function(){switch(this.editorType){case "aloha":return this.editableContent.getContents();case "codemirror":return this.cm.getValue()}},setValue:function(a){switch(this.editorType){case "aloha":this.editableContent&&this.editableContent.setContents(a);break;case "codemirror":this.cm.setValue(a)}},startEdit:function(){this._editorStarted||
(this.saveButton.set("disabled",!1),this.resetButton.set("disabled",!1),G_SERVER_COM.callServerFunction(this.startEditClass,this.startEditFunc,this.startEditUidPath,this.startEditParams),this._editorStarted=!0)},pauseEdit:function(){this._editorStarted&&this.getValue()==this._savedContent&&this.stopEdit()},startEditCM:function(a){this.startEdit()},pauseEditCM:function(a){this.pauseEdit()},startEditA:function(a,b){b.editable.getId()==this.id+"_container"&&this.startEdit()},pauseEditA:function(a,b){b.editable.getId()==
this.id+"_container"&&this.pauseEdit()},stopEdit:function(){this._editorStarted&&(G_SERVER_COM.callServerFunction(this.stopEditClass,this.stopEditFunc,this.stopEditUidPath,this.stopEditParams),this.saveButton.set("disabled",!0),this.resetButton.set("disabled",!0),this._editorStarted=!1)},save:function(){this.stopEdit();var a=dojo.clone,a=dojo.clone(this.saveParams);a.content=this.getValue();this._savedContent=a.content;G_SERVER_COM.callServerFunction(this.saveClass,this.saveFunc,this.saveUidPath,
a)},load:function(){this.stopEdit();G_SERVER_COM.callServerFunction(this.loadClass,this.loadFunc,this.loadUidPath,this.loadParams,this.loadCallback.bind(this))}});dojo.declare("FIRMOS.Shell",dijit.layout.ContentPane,{postCreate:function(){this.set("content",'<iframe id="'+this.id+'_frame" src="'+this.protocol+"://"+this.host+":"+this.port+this.path+'" style="width:100%; height:100%;">Iframe not supported.</iframe>');this.set("style","overflow: hidden;");this.inherited(arguments)}});dojo.declare("FIRMOS.VNC",
dijit.layout.BorderContainer,{texts:G_TEXTS.vnc,constructor:function(a){this.ws=null;this.state="disconnected";this.container=this.canvas=null;this.securityType=0;this.serverSettings={};this.tileImage=this.context=null;this.mouseButtonState=0;this.intervalId=this.mouseCoords=null;this.scale=1;this.isActive=!1;this._events=[]},destroy:function(){this.disconnect();this.inherited(arguments)},postCreate:function(){this.vncCP=new dijit.layout.ContentPane({region:"center",splitter:!1});this.vncCP.set("content",
'<div id="'+this.id+'_container" style="width:100%; height:100%;"><canvas  class="firmosVNCInactive" tabindex="0" id="'+this.id+'_vnc" style="width:0px; height:0px; cursor: none;">Canvas not supported.</canvas></div>');this.vncCP.set("style","overflow: hidden;");this.toolbar=new dijit.Toolbar({region:"top"});this.cadButton=new dijit.form.Button({label:this.texts.cadButton,onClick:this.sendCAD.bind(this)});this.toolbar.addChild(this.cadButton);this.wakeUpButton=new dijit.form.Button({label:this.texts.wakeUpButton,
disabled:!0,onClick:this.wakeUp.bind(this)});this.toolbar.addChild(this.wakeUpButton);this.mountButton=new dijit.form.Button({label:this.texts.mountButton,disabled:!0,onClick:this.mountISO.bind(this)});this.toolbar.addChild(this.mountButton);this.addChild(this.toolbar);this.addChild(this.vncCP);this.inherited(arguments);setTimeout(this.connect.bind(this),0)},sendCAD:function(){this.ws.send((new Uint8Array([4,1,0,0,0,0,255,227])).buffer);this.ws.send((new Uint8Array([4,1,0,0,0,0,255,233])).buffer);
this.ws.send((new Uint8Array([4,1,0,0,0,0,255,255])).buffer);this.ws.send((new Uint8Array([4,0,0,0,0,0,255,227])).buffer);this.ws.send((new Uint8Array([4,0,0,0,0,0,255,233])).buffer);this.ws.send((new Uint8Array([4,0,0,0,0,0,255,255])).buffer)},wakeUp:function(){},mountISO:function(){},stopEvent:function(a){dojo.stopEvent(a);a.preventDefault();a.stopPropagation();return!1},visibilityChange:function(a){a?this.connect():this.disconnect()},disconnect:function(){if("disconnected"!=this.state){this.canvas.style.width=
"0px";for(this.canvas.style.height="0px";0<this._events.length;)dojo.disconnect(this._events.pop());this.ws.onopen=null;this.ws.onmessage=null;this.ws.onerror=null;this.ws.close();this.ws=null;this.state="disconnected"}},connect:function(){this.state="connecting";this.ws=new WebSocket(("https:"==document.location.protocol?"wss://":"ws://")+window.location.hostname+":"+window.location.port+"/FirmOS_FRE_WS","FirmOS-VC|"+this.host+"|"+this.port);this.ws.binaryType="arraybuffer";this.ws.onopen=this.wsOpenListener.bind(this);
this.ws.onmessage=this.wsMessageListener.bind(this);this.ws.onerror=this.wsErrorListener.bind(this);this.canvas=dojo.byId(this.id+"_vnc");this.container=dojo.byId(this.id+"_container");this.context=this.canvas.getContext("2d");this._events.push(dojo.connect(this.canvas,"onmousemove",this.mouseMoveListener.bind(this)));this._events.push(dojo.connect(this.canvas,"onmousedown",this.mouseDownListener.bind(this)));this._events.push(dojo.connect(this.canvas,"onmouseup",this.mouseUpListener.bind(this)));
this._events.push(dojo.connect(this.canvas,"onclick",this.mouseClickListener.bind(this)));this._events.push(dojo.connect(this.canvas,"oncontextmenu",this.contextMenuListener.bind(this)));this._events.push(dojo.connect(this.canvas,"onmouseenter",this.mouseEnter.bind(this)));this._events.push(dojo.connect(this.canvas,"onmouseout",this.mouseOut.bind(this)));this._events.push(dojo.connect(this.canvas,"onkeydown",this.keyDownListener.bind(this)));this._events.push(dojo.connect(this.canvas,"onkeyup",this.keyUpListener.bind(this)));
this._events.push(dojo.connect(this.canvas,"onkeypress",this.keyPressListener.bind(this)));this._events.push(dojo.connect(this,"resize",this.applyScale.bind(this)));this.intervalId&&window.clearInterval(this.intervalId);this.intervalId=window.setInterval(this.sendMouseCoords.bind(this),40);this.ws.onclose=this.wsCloseListener.bind(this)},decodeMessage2String:function(a){a=new Uint8Array(a);for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},encodeString2Message:function(a){for(var b=
new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer},byteArray2String:function(a,b,c){c=c||a.length;var d="";for(b=b||0;b<c;b++)d+=String.fromCharCode(a[b]);return d},applyScale:function(){var a=dojo.position(this.container);a.w-=2;a.h-=2;if(a.w<this.serverSettings.width||a.h<this.serverSettings.height)this.scale=this.serverSettings.width/this.serverSettings.height>a.w/a.h?a.w/this.serverSettings.width:a.h/this.serverSettings.height;this.canvas.style.width=Math.floor(this.serverSettings.width*
this.scale)+"px";this.canvas.style.height=Math.floor(this.serverSettings.height*this.scale)+"px"},wsMessageListener:function(a){switch(this.state){case "init":a=this.decodeMessage2String(a.data);switch(a){case "RFB 003.008\n":this.vncVersion=3.8;this.state="security";this.ws.send(this.encodeString2Message(a));break;default:console.error('Version "'+a+'" not supported'),this.ws.close()}break;case "security":var b=new Uint8Array(a.data);0==b[0]&&(console.error("Got no valid security type"),this.ws.close());
for(a=0;a<b[0];a++)1==b[a]&&(this.securityType=b[a]);switch(this.securityType){case 0:console.error("Got no valid security type");this.ws.close();break;case 1:this.state="securityResult";this.ws.send((new Uint8Array([this.securityType])).buffer);break;case 2:console.error("VNC Authentication not supported"),this.ws.close()}break;case "securityResult":a=new Uint8Array(a.data);0!=(a[0]||a[1]||a[2]||a[3])?(console.error("Security handshake failed"),this.ws.close()):(this.state="serverInit",this.ws.send((new Uint8Array([1])).buffer));
break;case "serverInit":a=new Uint8Array(a.data);this.serverSettings.width=256*a[0]+a[1];this.serverSettings.height=256*a[2]+a[3];this.applyScale();this.serverSettings.bitPerPixel=a[4];32!=this.serverSettings.bitPerPixel&&console.error("Only True Color supported");this.serverSettings.depth=a[5];this.serverSettings.bigEndianFlag=a[6];this.serverSettings.trueColorFlag=a[7];this.serverSettings.redMax=256*a[8]+a[9];this.serverSettings.greenMax=256*a[10]+a[11];this.serverSettings.blueMax=256*a[12]+a[13];
this.serverSettings.redShift=a[14];this.serverSettings.greenShift=a[15];this.serverSettings.blueShift=a[16];this.serverSettings.name=this.byteArray2String(a,24+256*(256*(256*a[20]+a[21])+a[22])+a[23]);this.state="connected";this.tileImage=this.context.createImageData(16,16);this.canvas.width=this.serverSettings.width;this.canvas.height=this.serverSettings.height;this.ws.send((new Uint8Array([0,0,0,0,32,24,0,1,0,255,0,255,0,255,16,8,0,0,0,0])).buffer);this.ws.send((new Uint8Array([2,0,0,3,0,0,0,1,
0,0,0,5,0,0,0,0])).buffer);this.ws.send((new Uint8Array([3,0,0,0,0,0,a[0],a[1],a[2],a[3]])).buffer);break;case "connected":b=new Uint8Array(a.data);switch(b[0]){case 0:var c=256*b[2]+b[3];if(0==c)break;var d=4;for(a=0;a<c;a++){var e=256*b[d]+b[d+1],f=256*b[d+2]+b[d+3],g=256*b[d+4]+b[d+5],h=256*b[d+6]+b[d+7],d=d+8,k=b[d+3],d=d+4;switch(k){case 0:d=this.handleRaw(b,e,f,g,h,d);break;case 1:d=this.handleCopyrect(b,e,f,g,h,d);break;case 5:d=this.handleHextile(b,e,f,g,h,d);break;case 252:d=this.handleTightPng(b,
e,f,g,h,d);break;default:console.error("Unknown Encoding "+b[12]+"-"+b[13]+"-"+b[14]+"-"+b[15])}}break;default:console.warn("Unknown Server Message "+b[0])}break;case "disconnected":break;default:console.error("State "+this.state+" not implemented")}},reconnect:function(){console.log("RECONNECT!!!");this.disconnect()},_getMouseXY:function(a){for(var b=this.canvas,c=[0,0];b.offsetParent;)c[0]=c[0]+b.offsetLeft-b.scrollLeft,c[1]=c[1]+b.offsetTop-b.scrollTop,b=b.offsetParent;c[0]=a.clientX+document.body.scrollLeft+
document.documentElement.scrollLeft-c[0];c[1]=a.clientY+document.body.scrollTop+document.documentElement.scrollTop-c[1];c[0]/=this.scale;c[1]/=this.scale;return c},sendMouseCoords:function(){this.mouseCoords&&(this.ws.send((new Uint8Array([5,this.mouseButtonState,this.mouseCoords[0]>>8,this.mouseCoords[0]&255,this.mouseCoords[1]>>8,this.mouseCoords[1]&255])).buffer),this.mouseCoords=null)},mouseEnter:function(a){this.canvas.focus();dojo.addClass(this.canvas,"firmosVNCActive");dojo.removeClass(this.canvas,
"firmosVNCInactive");this.isActive=!0},mouseOut:function(a){dojo.addClass(this.canvas,"firmosVNCInactive");dojo.removeClass(this.canvas,"firmosVNCActive");this.isActive=!1},mouseMoveListener:function(a){this.isActive||this.mouseEnter(a);this.mouseCoords=this._getMouseXY(a)},mouseDownListener:function(a){this.mouseButtonState|=1<<a.button;a=this._getMouseXY(a);this.ws.send((new Uint8Array([5,this.mouseButtonState,a[0]>>8,a[0]&255,a[1]>>8,a[1]&255])).buffer);this.mouseCoords=null},mouseUpListener:function(a){this.mouseButtonState^=
1<<a.button;a=this._getMouseXY(a);this.ws.send((new Uint8Array([5,this.mouseButtonState,a[0]>>8,a[0]&255,a[1]>>8,a[1]&255])).buffer);this.mouseCoords=null},mouseClickListener:function(a){return!1},contextMenuListener:function(a){return!1},getSpecialKeyCode:function(a){switch(a.keyCode){case 8:return 65288;case 9:return 65289;case 13:return 65293;case 27:return 65307;case 45:return 65379;case 46:return 65535;case 36:return 65360;case 35:return 65367;case 33:return 65365;case 34:return 65366;case 37:return 65361;
case 38:return 65362;case 39:return 65363;case 40:return 65364;case 112:return 65470;case 113:return 65471;case 114:return 65472;case 115:return 65473;case 116:return 65474;case 117:return 65475;case 118:return 65476;case 119:return 65477;case 120:return 65478;case 121:return 65479;case 122:return 65480;case 123:return 65481;case 16:return 65505;case 17:return 65507;case 18:return 65406}return 0},keyDownListener:function(a){if(this.isActive){var b=this.getSpecialKeyCode(a);0!=b&&(this.stopEvent(a),
this.ws.send((new Uint8Array([4,1,0,0,b>>24&255,b>>16&255,b>>8&255,b&255])).buffer));return!1}},keyUpListener:function(a){if(this.isActive){var b=this.getSpecialKeyCode(a);b&&(this.stopEvent(a),this.ws.send((new Uint8Array([4,0,0,0,b>>24&255,b>>16&255,b>>8&255,b&255])).buffer));return!1}},keyPressListener:function(a){if(this.isActive)return 0!=a.which&&0!=a.charCode&&(this.stopEvent(a),a=0<a.charCode?[a.charCode>>24&255,a.charCode>>16&255,a.charCode>>8&255,a.charCode&255]:[a.which>>24&255,a.which>>
16&255,a.which>>8&255,a.which&255],this.ws.send((new Uint8Array([4,1,0,0,a[0],a[1],a[2],a[3],4,0,0,0,a[0],a[1],a[2],a[3]])).buffer)),!1},handleCopyrect:function(a,b,c,d,e,f){var g=256*a[f]+a[f+1];f+=2;a=256*a[f]+a[f+1];f+=2;this.context.drawImage(this.canvas,g,a,d,e,b,c,d,e);return f},handleRaw:function(a,b,c,d,e,f){for(var g=this.context.createImageData(d,e),h,k,l=0;l<d*e;l++)h=4*l,k=h+f,g.data[h]=a[k+2],g.data[h+1]=a[k+1],g.data[h+2]=a[k],g.data[h+3]=255;this.context.putImageData(g,b,c);return k+
4},handleHextile:function(a,b,c,d,e,f){for(var g=Math.ceil(d/16),h=Math.ceil(e/16),k=[0,0,0,255],l=[0,0,0,255],m=[0,0,0,255],n,r=0;r<h;r++)for(var s=0;s<g;s++){n=a[f];f++;var p=16,m=16;r==h-1&&(m=16-(16*h-e));s==g-1&&(p=16-(16*g-d));var t=p*m;if(0==n)this.context.fillStyle="rgb("+k[2]+","+k[1]+","+k[0]+")",this.context.fillRect(b+16*s,c+16*r,p,m);else if(n&1){var q,u;n=256==t?this.tileImage:this.context.createImageData(p,m);for(p=0;p<t;p++)q=4*p,u=q+f,n.data[q]=a[u+2],n.data[q+1]=a[u+1],n.data[q+
2]=a[u],n.data[q+3]=255;this.context.putImageData(n,b+16*s,c+16*r);f=u+4}else if(n&2&&(k=[a[f],a[f+1],a[f+2],a[f+3]],f+=4),n&4&&(l=[a[f],a[f+1],a[f+2],a[f+3]],f+=4),t=b+16*s,q=c+16*r,this.context.fillStyle="rgb("+k[2]+","+k[1]+","+k[0]+")",this.context.fillRect(t,q,p,m),n&8){var v=a[f];f++;for(p=0;p<v;p++){n&16?(m=[a[f],a[f+1],a[f+2],a[f+3]],f+=4):m=l;var w=a[f]>>4,x=a[f]&15;f++;var y=(a[f]>>4)+1,z=(a[f]&15)+1;f++;this.context.fillStyle="rgb("+m[2]+","+m[1]+","+m[0]+")";this.context.fillRect(t+w,
q+x,y,z)}}}return f},wsErrorListener:function(a){console.error("wsError "+JSON.stringify(a));this.reconnect()},wsCloseListener:function(){this.state="disconnected";this.intervalId&&window.clearInterval(this.intervalId)},wsOpenListener:function(){this.state="init"}})});
